"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleSdkException=exports.contains=exports.proxyFun=exports.parseApiVersion=exports.HmsParser=exports.OhosParser=exports.hmsPredict=exports.ohosPredict=void 0;const hos_local_component_loader_js_1=require("@ohos/hos-sdkmanager-common/build/src/hos/loader/hos-local-component-loader.js"),hvigor_1=require("@ohos/hvigor"),sdkmanager_common_1=require("@ohos/sdkmanager-common"),fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),common_const_js_1=require("../const/common-const.js"),project_build_profile_js_1=require("../options/build/project-build-profile.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js");var ApiValType=project_build_profile_js_1.ProjectBuildProfile.ApiValType;const LOGGER=ohos_logger_js_1.OhosLogger.getLogger("Sdk"),ohosPredict=(o,e,r)=>{const s=new Map,t=path_1.default.resolve(o,e);if(r.filter((o=>!fs_1.default.existsSync(path_1.default.resolve(t,o,common_const_js_1.CommonConst.OHOS_SDK_COMPONENT_DEFINITION)))).length>0)return s;const n=new OhosParser(o),a=r.map((o=>path_1.default.resolve(t,o,"oh-uni-package.json")));return n.parse(a).map((o=>[new sdkmanager_common_1.PathAndApiVersion(o.getPath(),o.getApiVersion()),o])).forEach((o=>s.set(o[0],o[1]))),s};exports.ohosPredict=ohosPredict;const hmsPredict=(o,e,r)=>{const s=new Map,t=path_1.default.resolve(o,"hmscore",e.api);if(r.filter((o=>!fs_1.default.existsSync(path_1.default.resolve(t,o,common_const_js_1.CommonConst.HMS_SDK_COMPONENT_DEFINITION)))).length>0)return s;const n=new HmsParser(o),a=r.map((o=>path_1.default.resolve(t,o,"uni-package.json")));return n.parse(a).map((o=>[o.getPath(),o])).forEach((o=>s.set(o[0],o[1]))),s};exports.hmsPredict=hmsPredict;class OhosParser extends sdkmanager_common_1.OhLocalComponentLoader{constructor(o){super(o)}parse(o){return this.parseSdks(o)}}exports.OhosParser=OhosParser;class HmsParser extends hos_local_component_loader_js_1.HosLocalComponentLoader{constructor(o){super(o)}parse(o){return this.parseSdks(o)}}exports.HmsParser=HmsParser;const parseApiVersion=o=>{if("number"==typeof o)return{api:`${o}`,version:o,type:ApiValType.NUM};const e=/\s*([1-9].[0-9].[0-9])\s*\(\s*(\d+)\s*\)\s*$/g.exec(o);return 3!==(null==e?void 0:e.length)&&LOGGER._buildError('In HarmonyOS configuration mode,the value of compileSdkVersion/compatibleSdkVersion/targetSdkVersion must be M.S.F when API level is 10 or later, Example："4.0.0(10)";\nIn OpenHarmony configuration mode,the value of compileSdkVersion/compatibleSdkVersion/targetSdkVersion must be a number, Example：10;')._printErrorAndExit(),{api:e[1],version:parseInt(e[2]),type:ApiValType.STRING}};exports.parseApiVersion=parseApiVersion;const proxyFun=()=>{var o,e,r;const s=hvigor_1.GlobalParam.getInstance();return{proxy:s.getConfig("proxy"),httpsProxy:s.getConfig("https-proxy"),noProxy:null!==(r=null!==(e=null!==(o=s.getConfig("noproxy"))&&void 0!==o?o:s.getConfig("no-proxy"))&&void 0!==e?e:process.env.NO_PROXY)&&void 0!==r?r:process.env.npm_config_noproxy}};exports.proxyFun=proxyFun;const contains=(o,e)=>{for(const[r,s]of e)if(r===o)return s};exports.contains=contains;const handleSdkException=o=>{if(!(o instanceof sdkmanager_common_1.SdkException))throw o;{const e=o.getErrorTip();LOGGER._buildError(e.getReason())._solution(`${e.getFixSuggestion()}`)._printErrorAndExit()}};exports.handleSdkException=handleSdkException;