"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NodeOhosTestBuildTaskCA=exports.NodeHarBuildTaskCA=exports.NodeBuildTaskCA=exports.ArkTsColdReloadCA=exports.ArkTsHotReloadCA=exports.ArkTsPreviewCA=exports.ArkTsUnitTestCA=exports.ArkTsOhosTestCA=exports.ArkTsHarTaskCA=exports.ArkTsTaskCA=exports.initializeArkTsTasks=void 0;const sdk_const_js_1=require("../../const/sdk-const.js"),code_type_enum_js_1=require("../../enum/code-type-enum.js"),module_type_enum_js_1=require("../../enum/module-type-enum.js"),task_util_js_1=require("../../utils/task-util.js"),ark_compile_js_1=require("../ark-compile.js"),cold_reload_ark_compile_js_1=require("../cold-reload-ark-compile.js"),task_names_js_1=require("../common/task-names.js"),compile_node_js_1=require("../compile-node.js"),compile_resource_js_1=require("../compile-resource.js"),generate_loader_json_js_1=require("../generate-loader-json.js"),har_ark_compile_js_1=require("../har/har-ark-compile.js"),har_compile_node_js_1=require("../har/har-compile-node.js"),hot_reload_ark_compile_js_1=require("../hot-reload-ark-compile.js"),ohos_test_ark_compile_js_1=require("../ohos-test-ark-compile.js"),ohos_test_compile_node_js_1=require("../ohos-test-compile-node.js"),previewer_ark_compile_js_1=require("../previewer-ark-compile.js"),task_creator_js_1=require("../task-creator.js"),unit_test_ark_compile_js_1=require("../unitTest/unit-test-ark-compile.js");var CommonTask=task_names_js_1.TaskNames.CommonTask;const har_target_util_js_1=require("../../utils/har-target-util.js"),initializeArkTsTasks=(e,s)=>{e.getModuleService().getModuleModel().getModuleType()===module_type_enum_js_1.ModuleType.Har?(s.registry(new ArkTsHarTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new NodeHarBuildTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new NodeBuildTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new NodeBuildTaskCA(e,code_type_enum_js_1.CodeType.JS))):(s.registry(new ArkTsTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsTaskCA(e,code_type_enum_js_1.CodeType.JS)),s.registry(new NodeBuildTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new NodeBuildTaskCA(e,code_type_enum_js_1.CodeType.JS))),s.registry(new ArkTsHotReloadCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsColdReloadCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsPreviewCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsOhosTestCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new ArkTsOhosTestCA(e,code_type_enum_js_1.CodeType.JS)),s.registry(new NodeOhosTestBuildTaskCA(e,code_type_enum_js_1.CodeType.ETS)),s.registry(new NodeOhosTestBuildTaskCA(e,code_type_enum_js_1.CodeType.JS)),s.registry(new ArkTsUnitTestCA(e,code_type_enum_js_1.CodeType.ETS))};exports.initializeArkTsTasks=initializeArkTsTasks;class ArkTsTaskCA extends task_creator_js_1.TargetTaskCreator{constructor(e,s){super(e),this.provider=()=>new ark_compile_js_1.ArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.COMPILE_ARK),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.COMPILE_ARK),this.declareDepends=()=>[generate_loader_json_js_1.GenerateLoaderJson.name,compile_resource_js_1.CompileResource.name].concat(getBuildProfileDependence(this.targetService)),this.codeType=s}}exports.ArkTsTaskCA=ArkTsTaskCA;class ArkTsHarTaskCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new har_ark_compile_js_1.HarArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.HAR_COMPILE),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.HAR_COMPILE),this.declareDepends=()=>(0,task_util_js_1.limitMinApiVersion)(this.targetService.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9)?[generate_loader_json_js_1.GenerateLoaderJson.name,compile_resource_js_1.CompileResource.name,CommonTask.CREATE_HAR_BUILD_PROFILE.name]:[generate_loader_json_js_1.GenerateLoaderJson.name,compile_resource_js_1.CompileResource.name]}}exports.ArkTsHarTaskCA=ArkTsHarTaskCA;class ArkTsOhosTestCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new ohos_test_ark_compile_js_1.OhosTestArkCompile(this.targetService,this.codeType),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.OHOS_TEST_ARK_COMPILE)}}exports.ArkTsOhosTestCA=ArkTsOhosTestCA;class ArkTsUnitTestCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new unit_test_ark_compile_js_1.UnitTestArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.UNIT_TEST),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.UNIT_TEST),this.declareDepends=()=>[task_names_js_1.TaskNames.Task.BUILD_UNIT_TEST_RES.name,task_names_js_1.TaskNames.CommonTask.UNIT_TEST_PROCESS_PROFILE.name].concat(getBuildProfileDependence(this.targetService))}}exports.ArkTsUnitTestCA=ArkTsUnitTestCA;class ArkTsPreviewCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new previewer_ark_compile_js_1.PreviewerArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.PREVIEW),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.PREVIEW),this.declareDepends=()=>{const e=[task_names_js_1.TaskNames.Task.PREVIEW_UPDATE_ASSETS.name];return(0,task_util_js_1.limitMinApiVersion)(this.targetService.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9)&&e.push(task_names_js_1.TaskNames.CommonTask.CREATE_BUILD_PROFILE.name),e}}}exports.ArkTsPreviewCA=ArkTsPreviewCA;class ArkTsHotReloadCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new hot_reload_ark_compile_js_1.HotReloadArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.HOT_RELOAD),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.HOT_RELOAD),this.declareDepends=()=>{const e=(0,task_util_js_1.limitMinApiVersion)(this.targetService.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9),s=["buildHotReloadResource"];if(e){s.push(`${this.targetService.getTargetData().getTargetName()}@${CommonTask.CREATE_BUILD_PROFILE.name}`);har_target_util_js_1.HarTargetUtil.calDepHarTargets(this.targetService).forEach(((e,a)=>s.push(`${a}:${e}@${CommonTask.CREATE_HAR_BUILD_PROFILE.name}`)))}return s},this.afterConfigure=()=>{this.depends=this.declareDepends().map((e=>e.includes(":")?e:`${this.node.getName()}:${e}`))}}}exports.ArkTsHotReloadCA=ArkTsHotReloadCA;class ArkTsColdReloadCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new cold_reload_ark_compile_js_1.ColdReloadArkCompile(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.COLD_RELOAD),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.COLD_RELOAD),this.declareDepends=()=>{const e=(0,task_util_js_1.limitMinApiVersion)(this.targetService.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9),s=["buildHotReloadResource"];return e&&(s.push(`${this.targetService.getTargetData().getTargetName()}@${CommonTask.CREATE_BUILD_PROFILE.name}`),this.targetService.getModuleService().getHarModuleDependencyNames().forEach((e=>{const a=`${e}:${har_target_util_js_1.HarTargetUtil.getHarTargetName(this.targetService,e)}@${CommonTask.CREATE_HAR_BUILD_PROFILE.name}`;s.push(a)}))),s},this.afterConfigure=()=>{this.depends=this.declareDepends().map((e=>e.includes(":")?e:`${this.node.getName()}:${e}`))}}}exports.ArkTsColdReloadCA=ArkTsColdReloadCA;class NodeBuildTaskCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new compile_node_js_1.CompileNode(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.COMPILE_NODE),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.COMPILE_NODE),this.declareDepends=()=>[generate_loader_json_js_1.GenerateLoaderJson.name,compile_resource_js_1.CompileResource.name]}}exports.NodeBuildTaskCA=NodeBuildTaskCA;class NodeHarBuildTaskCA extends NodeBuildTaskCA{constructor(){super(...arguments),this.provider=()=>new har_compile_node_js_1.HarCompileNode(this.targetService,this.codeType,task_names_js_1.TaskNames.Task.HAR_BUILD),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.HAR_BUILD)}}exports.NodeHarBuildTaskCA=NodeHarBuildTaskCA;class NodeOhosTestBuildTaskCA extends ArkTsTaskCA{constructor(){super(...arguments),this.provider=()=>new ohos_test_compile_node_js_1.OhosTestCompileNode(this.targetService,this.codeType),this.declareTaskDetail=()=>getLangCompileTaskName(this.codeType,task_names_js_1.TaskNames.Task.OHOS_TEST_COMPILE_NODE)}}exports.NodeOhosTestBuildTaskCA=NodeOhosTestBuildTaskCA;const getLangCompileTaskName=(e,s)=>({...s,name:`${s.name}${e===code_type_enum_js_1.CodeType.ETS?"ArkTS":e.toUpperCase()}`}),getBuildProfileDependence=e=>{const s=[];if((0,task_util_js_1.limitMinApiVersion)(e.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9)){s.push(CommonTask.CREATE_BUILD_PROFILE.name);har_target_util_js_1.HarTargetUtil.calDepHarTargets(e).forEach(((e,a)=>s.push(`${a}:${e}@${CommonTask.CREATE_HAR_BUILD_PROFILE.name}`)))}return s};