"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProcessResource=void 0;const path_1=__importDefault(require("path")),build_directory_const_js_1=require("../const/build-directory-const.js"),common_const_js_1=require("../const/common-const.js"),inject_util_js_1=require("../utils/inject-util.js"),abstract_process_resource_js_1=require("./abstract/abstract-process-resource.js"),task_names_js_1=require("./common/task-names.js"),unit_test_process_profile_js_1=require("./unitTest/unit-test-process-profile.js");var Task=task_names_js_1.TaskNames.Task;const fs_1=__importDefault(require("fs")),ohosTestTargetName=common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET;class ProcessResource extends abstract_process_resource_js_1.AbstractProcessResource{constructor(e){super(e,Task.PROCESS_RESOURCE),this.resConfigFilePath=path_1.default.resolve(this.outputDir,common_const_js_1.CommonConst.RES_CONFIG_FILE)}initTaskDepends(){super.initTaskDepends(),inject_util_js_1.InjectUtil.isUnitTestProcess()&&this.declareDepends(unit_test_process_profile_js_1.UnitTestProcessProfile.name)}initCommandBuilder(){var e;if(this.service.getModuleModel().isHapModule()||this.service.getModuleModel().isHspModule()||this.targetName===ohosTestTargetName){const s=this.targetData.getProduct();if(void 0!==s.resource&&0!==s.resource.directories.length){const t=path_1.default.resolve(this.projectModel.getProjectDir(),null===(e=s.resource)||void 0===e?void 0:e.directories[0]);this.restoolConfigBuilder.addInputDir(t,"App")}else this.restoolConfigBuilder.addInputDir(this.projectModel.getAppRes().getResourcePath(),"App")}const s=this.projectModel.getAppRes().getAppResOpt().app.bundleName,t=path_1.default.resolve(this.pathInfo.getIntermediatesRes(),"ids_map");if(this.restoolConfigBuilder.addJsonFile(this.processedJson).addModulePackName(s).addOutputDir(this.outputDir).addResTable(path_1.default.resolve(this.pathInfo.getGenerateSourceR(),build_directory_const_js_1.BuildArtifactConst.RESOURCE_TABLE_H)).addIdsPath(t).addDefinedIds(path_1.default.resolve(t,"id_defined.json")),!this.sdkInfo.isOhos){const e=path_1.default.resolve(this.sdkInfo.getHosToolchainsDir(),"id_defined.json");fs_1.default.existsSync(e)&&this.restoolConfigBuilder.addDefinedSysIds(e)}this.isEnabledIconCheck()&&this.restoolConfigBuilder.setIconCheck(!0),this.targetData.getTargetName()===ohosTestTargetName&&(this.addOhosTestExtraCompilationResources(this.restoolConfigBuilder),this.addIntermediatesSrcResource(this.restoolConfigBuilder,this.moduleModel.getSourceRootByTargetName(ohosTestTargetName)))}}exports.ProcessResource=ProcessResource;