"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GeneratePackRes=void 0;const hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),packing_tool_options_js_1=require("../builder/inner-java-command-builder/packing-tool-options.js"),process_utils_js_1=require("../utils/process-utils.js"),task_names_js_1=require("./common/task-names.js"),make_project_pack_info_js_1=require("./make-project-pack-info.js");var Task=task_names_js_1.TaskNames.Task;const base_pack_app_task_js_1=require("./base/base-pack-app-task.js"),duplicate_dependency_check_js_1=require("./duplicate-dependency-check.js");class GeneratePackRes extends base_pack_app_task_js_1.BasePackAppTask{constructor(e,s){super(e,s,Task.GeneratePackRes),this.needPackRes&&(this.packResCommand=(new packing_tool_options_js_1.PackingToolOptions).addCalledJarFile(this.packageTool).addMode("res").addEntryCardPath(this.entryCardDir).addPackInfoPath(this.packInfoPath).addOutPath(this.packResPath).force(!0).build())}declareExecutionCommand(){var e;return`${null===(e=this.packResCommand)||void 0===e?void 0:e.toString()}`}declareInputs(){return(new Map).set("needPackRes",this.needPackRes)}declareInputFiles(){const e=(new hvigor_1.FileSet).addEntry(this.packInfoPath,{isDirectory:!1});return this.needPackRes&&e.addEntry(this.entryCardDir,{isDirectory:!0}),e}declareOutputFiles(){const e=super.declareOutputFiles();return this.needPackRes&&e.addEntry(this.packResPath,{isDirectory:!1}),e}initTaskDepends(){this.dependsOn(duplicate_dependency_check_js_1.DuplicateDependencyCheck.name),this.dependsOn(make_project_pack_info_js_1.MakeProjectPackInfo.name)}async doTaskAction(){await this.generatePackRes()}async generatePackRes(){this.needPackRes?(this._log._printDebugCommand("PackRes",this.packResCommand),await(new process_utils_js_1.ProcessUtils).execute(this.packResCommand)):fs_extra_1.default.rmSync(this.packResPath,{force:!0})}}exports.GeneratePackRes=GeneratePackRes;