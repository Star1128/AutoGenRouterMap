"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,s,r,a){void 0===a&&(a=r);var t=Object.getOwnPropertyDescriptor(s,r);t&&!("get"in t?!s.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(e,a,t)}:function(e,s,r,a){void 0===a&&(a=r),e[a]=s[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,s){Object.defineProperty(e,"default",{enumerable:!0,value:s})}:function(e,s){e.default=s}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(s,e,r);return __setModuleDefault(s,e),s},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBuildProfileEtsDependencies=exports.BuildProfileTaskCA=exports.UnitTestProcessProfileCA=exports.MakePackInfoCA=exports.GenerateMetadataCA=exports.ProcessObfuscationFilesCA=exports.ArkLinterCA=exports.ProcessPackageJsonCA=exports.ProcessOhPackageJsonCA=exports.PackageHarCA=exports.SyscapTransformCA=exports.PreCheckSyscapCA=exports.SignHapCA=exports.BuildUnitTestHookCA=exports.ReplaceUnitTestIndexFileCA=exports.CopyPreviewProfileCA=exports.ReplacePreviewerPageCA=exports.PreviewUpdateAssetsCA=exports.PreviewCompileResourceCA=exports.PackageSharedTgzCA=exports.PrepareSharedHarResCA=exports.PackageSharedHarCA=exports.ProcessIntegratedHspCA=exports.SignModuleRemoteHspCA=exports.SignProjectRemoteHspCA=exports.PackageSignHarCA=exports.SignHspCA=exports.PackageHspCA=exports.GeneratePkgModuleJsonCA=exports.SignHqfCA=exports.PackageHqfCA=exports.PackageHapCA=exports.ProcessRouterMapCA=exports.GenerateLoaderJsonCA=exports.HarBuildProfileTaskCA=exports.MergeProfileCA=exports.ProcessProfileCA=exports.GeneratePkgContextInfoCA=exports.BeforeGenerateDeviceCoverageCA=exports.GenerateDeviceCoverageCA=exports.GenerateUnitTestResultCA=exports.GenerateOhosTestTemplateCA=exports.GenerateUnitTestTemplateCA=exports.PreBuildCA=exports.OhosTestCopyMockConfigJsonCA=void 0;const hvigor_1=require("@ohos/hvigor"),fse=__importStar(require("fs-extra")),path_1=__importDefault(require("path")),build_directory_const_js_1=require("../const/build-directory-const.js"),common_const_js_1=require("../const/common-const.js"),inject_const_js_1=require("../const/inject-const.js"),sdk_const_js_1=require("../const/sdk-const.js"),module_type_enum_js_1=require("../enum/module-type-enum.js"),har_target_util_js_1=require("../utils/har-target-util.js"),meta_util_js_1=require("../utils/meta-util.js"),task_util_js_1=require("../utils/task-util.js"),base_pack_hap_task_js_1=require("./base/base-pack-hap-task.js"),task_names_js_1=require("./common/task-names.js"),ark_linter_js_1=require("./har/ark-linter.js"),har_build_profile_task_js_1=require("./har/har-build-profile-task.js"),package_har_js_1=require("./har/package-har.js"),process_obfuscation_files_js_1=require("./har/process-obfuscation-files.js"),process_oh_package_json_js_1=require("./har/process-oh-package-json.js"),process_package_json_js_1=require("./har/process-package-json.js"),preview_hook_compile_resource_js_1=require("./hook/preview-hook-compile-resource.js"),package_hsp_js_1=require("./hsp/package-hsp.js"),package_shared_har_js_1=require("./hsp/package-shared-har.js"),package_shared_tgz_js_1=require("./hsp/package-shared-tgz.js"),prepare_shared_har_res_js_1=require("./hsp/prepare-shared-har-res.js"),sign_hsp_js_1=require("./hsp/sign-hsp.js"),legacy_package_hap_js_1=require("./legacy-tasks/legacy-package-hap.js"),creation_util_js_1=require("./manager/creation-util.js"),copy_preview_profile_js_1=require("./previewer/copy-preview-profile.js"),replace_previewer_page_js_1=require("./previewer/replace-previewer-page.js"),global_project_data_service_js_1=require("./service/global-project-data-service.js"),build_unit_test_hook_js_1=require("./unitTest/build-unit-test-hook.js"),generate_unit_test_result_js_1=require("./unitTest/generate-unit-test-result.js"),generate_unit_test_template_js_1=require("./unitTest/generate-unit-test-template.js"),replace_unit_test_index_file_js_1=require("./unitTest/replace-unit-test-index-file.js"),unit_test_process_profile_js_1=require("./unitTest/unit-test-process-profile.js"),before_generate_device_coverage_js_1=require("./before-generate-device-coverage.js"),build_profile_task_js_1=require("./build-profile-task.js"),compile_resource_js_1=require("./compile-resource.js"),generate_device_coverage_js_1=require("./generate-device-coverage.js"),generate_loader_json_js_1=require("./generate-loader-json.js"),generate_metadata_js_1=require("./generate-metadata.js"),generate_pkg_context_info_js_1=require("./generate-pkg-context-info.js"),make_pack_info_js_1=require("./make-pack-info.js"),merge_profile_js_1=require("./merge-profile.js"),ohos_test_copy_mock_config_json_js_1=require("./ohos-test-copy-mock-config-json.js"),package_hap_js_1=require("./package-hap.js"),package_hqf_js_1=require("./package-hqf.js"),pre_build_js_1=require("./pre-build.js"),pre_check_syscap_js_1=require("./pre-check-syscap.js"),preview_compile_resource_js_1=require("./preview-compile-resource.js"),preview_update_assets_js_1=require("./preview-update-assets.js"),process_integrated_hsp_js_1=require("./process-integrated-hsp.js"),process_profile_js_1=require("./process-profile.js"),process_router_map_js_1=require("./process-router-map.js"),sign_hap_js_1=require("./sign-hap.js"),sign_hqf_js_1=require("./sign-hqf.js"),sign_module_remote_hsp_js_1=require("./sign-module-remote-hsp.js"),sign_project_remote_hsp_js_1=require("./sign-project-remote-hsp.js"),syscap_transform_js_1=require("./syscap-transform.js"),task_creator_js_1=require("./task-creator.js");var Tasks=task_names_js_1.TaskNames.Task,CommonTask=task_names_js_1.TaskNames.CommonTask;const hsp_target_utils_js_1=require("../utils/hsp-target-utils.js"),inject_util_js_1=require("../utils/inject-util.js"),package_sign_har_js_1=require("./har/package-sign-har.js"),generate_ohos_test_template_js_1=require("./ohosTest/generate-ohos-test-template.js"),build_native_with_cmake_js_1=require("./build-native-with-cmake.js"),generate_pkg_module_json_js_1=require("./generate-pkg-module-json.js");class OhosTestCopyMockConfigJsonCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new ohos_test_copy_mock_config_json_js_1.OhosTestCopyMockConfigJson(this.targetService),this.declareDepends=()=>["OhosTestCompileArkTS"],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.OHOS_TEST_COPY_MOCK_CONFIG_JSON}}exports.OhosTestCopyMockConfigJsonCA=OhosTestCopyMockConfigJsonCA;class PreBuildCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new pre_build_js_1.PreBuild(this.targetService),this.declareDepends=()=>(0,meta_util_js_1.hvigorOrToolChainsChanged)(this.targetService.getSdkInfo())?[CommonTask.CLEAN.name]:[],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PRE_BUILD,this.afterConfigure=()=>{this.depends=this.declareDepends().map((e=>`${this.node.getName()}:${e}`))}}}exports.PreBuildCA=PreBuildCA;class GenerateUnitTestTemplateCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_unit_test_template_js_1.GenerateUnitTestTemplate(this.targetService),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_UNIT_TEST_TEMPLATE}}exports.GenerateUnitTestTemplateCA=GenerateUnitTestTemplateCA;class GenerateOhosTestTemplateCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_ohos_test_template_js_1.GenerateOhosTestTemplate(this.targetService),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_OHOS_TEST_TEMPLATE}}exports.GenerateOhosTestTemplateCA=GenerateOhosTestTemplateCA;class GenerateUnitTestResultCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_unit_test_result_js_1.GenerateUnitTestResult(this.targetService),this.declareDepends=()=>[this.isFa?"LegacyUnitTestArkTS":"UnitTestArkTS"],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_UNIT_TEST_RESULT}}exports.GenerateUnitTestResultCA=GenerateUnitTestResultCA;class GenerateDeviceCoverageCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_device_coverage_js_1.GenerateDeviceCoverage(this.targetService),this.declareDepends=()=>{const e=[pre_build_js_1.PreBuild.name];if(!hvigor_1.globalData.cliOpts._.includes(common_const_js_1.CommonConst.ON_DEVICE_TEST))return e;if("default"!==this.targetService.getTargetData().getTargetName())return e;if(!this.targetService.getModuleService().findTargetDataByName(common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET))return e;const s=path_1.default.resolve(path_1.default.resolve(this.targetService.getModuleService().getModuleModel().getProjectDir(),build_directory_const_js_1.BuildDirConst.SRC),common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET);if(!fse.existsSync(s))return e;const r=this.targetService.getModuleService().getModuleModel().getModuleType();let a="";return r===module_type_enum_js_1.ModuleType.Entry||r===module_type_enum_js_1.ModuleType.Feature?a=sign_hap_js_1.SignHap.name:r===module_type_enum_js_1.ModuleType.Shared?a=sign_hsp_js_1.SignHsp.name:r===module_type_enum_js_1.ModuleType.Har&&(a=package_har_js_1.PackageHar.name),a&&(0,creation_util_js_1.deviceTestComputeDepends)(e,a,this.targetService,r),e.push(before_generate_device_coverage_js_1.BeforeGenerateDeviceCoverage.name),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_DEVICE_COVERAGE}}exports.GenerateDeviceCoverageCA=GenerateDeviceCoverageCA;class BeforeGenerateDeviceCoverageCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new before_generate_device_coverage_js_1.BeforeGenerateDeviceCoverage(this.targetService),this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.BEFORE_GENERATE_DEVICE_COVERAGE}declareDepends(){const e=[pre_build_js_1.PreBuild.name];return this.targetService.getModuleService().getModuleModel().getModuleType()===module_type_enum_js_1.ModuleType.Shared&&e.push(sign_hsp_js_1.SignHsp.name),this.targetService.getModuleService().getHspModuleDependencyNames().forEach((s=>{var r;for(const a of[this.targetService.getTargetData().getTargetName(),common_const_js_1.DefaultTargetConst.DEFAULT_TARGET]){const t=this.targetService.getTargetData().findTargetDataByName(s,a);if(void 0===t)continue;let _=`${t.getTargetName()}@${task_names_js_1.TaskNames.Task.BEFORE_GENERATE_DEVICE_COVERAGE.name}`;(null===(r=this.node.findModuleByName(s))||void 0===r?void 0:r.getTaskContainer().hasTask(_))&&(_=`${s}:${_}`,e.push(_))}})),e}}exports.BeforeGenerateDeviceCoverageCA=BeforeGenerateDeviceCoverageCA;class GeneratePkgContextInfoCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_pkg_context_info_js_1.GeneratePkgContextInfo(this.targetService),this.declareDepends=()=>{var e,s;const r=[pre_build_js_1.PreBuild.name];this.targetService.getShouldBuildCmake()&&(null===(e=this.targetService.getBuildOption().strictMode)||void 0===e?void 0:e.useNormalizedOHMUrl)&&r.push(build_native_with_cmake_js_1.BuildNativeWithCmake.name);const a=har_target_util_js_1.HarTargetUtil.calDepHarTargets(this.targetService);for(const[e,t]of a){const a=this.targetService.getModuleService().getProjectModel().getTarget(e,t);a&&a.getShouldBuildCmake()&&(null===(s=a.getBuildOption().strictMode)||void 0===s?void 0:s.useNormalizedOHMUrl)&&r.push(`${e}:${t}@${build_native_with_cmake_js_1.BuildNativeWithCmake.name}`)}return r},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_PKG_CONTEXT_INFO}}exports.GeneratePkgContextInfoCA=GeneratePkgContextInfoCA;class ProcessProfileCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new process_profile_js_1.ProcessProfile(this.targetService),this.declareDepends=()=>[merge_profile_js_1.MergeProfile.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PROCESS_PROFILE}}exports.ProcessProfileCA=ProcessProfileCA;class MergeProfileCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new merge_profile_js_1.MergeProfile(this.targetService),this.declareDepends=()=>{const e=this.node.getName(),s=this.targetService.getTargetData().getTargetName(),r=[`${e}:${s}@${pre_build_js_1.PreBuild.name}`];hsp_target_utils_js_1.HspTargetUtils.calDepHspTargets(this.targetService).forEach(((e,s)=>r.push(`${s}:${e.getTargetName()}@${merge_profile_js_1.MergeProfile.name}`)));return har_target_util_js_1.HarTargetUtil.calDepHarTargets(this.targetService).forEach(((e,s)=>r.push(`${s}:${e}@${Tasks.MERGE_PROFILE.name}`))),hvigor_1.hvigorCore.isCommandEntryTask(task_names_js_1.TaskNames.Task.TEST.name)&&r.push(`${e}:${s}@${task_names_js_1.TaskNames.Task.GENERATE_UNIT_TEST_TEMPLATE.name}`),r},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.MERGE_PROFILE,this.afterConfigure=()=>this.depends=this.declareDepends()}}exports.MergeProfileCA=MergeProfileCA;class HarBuildProfileTaskCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[...[pre_build_js_1.PreBuild.name],...getBuildProfileEtsDependencies(this.targetService)],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.CREATE_HAR_BUILD_PROFILE,this.provider=()=>new har_build_profile_task_js_1.HarBuildProfileTask(this.targetService)}}exports.HarBuildProfileTaskCA=HarBuildProfileTaskCA;class GenerateLoaderJsonCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_loader_json_js_1.GenerateLoaderJson(this.targetService),this.declareDepends=()=>{const e=[process_router_map_js_1.ProcessRouterMap.name],s=hsp_target_utils_js_1.HspTargetUtils.calDepHspTargets(this.targetService);return inject_util_js_1.InjectUtil.isPreviewProcess()?s.forEach(((s,r)=>e.push(`${r}:${s.getTargetName()}@${preview_compile_resource_js_1.PreviewCompileResource.name}`))):s.forEach(((s,r)=>e.push(`${r}:${s.getTargetName()}@${compile_resource_js_1.CompileResource.name}`))),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_LOADER_JSON}}exports.GenerateLoaderJsonCA=GenerateLoaderJsonCA;class ProcessRouterMapCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new process_router_map_js_1.ProcessRouterMap(this.targetService),this.declareDepends=()=>[generate_pkg_context_info_js_1.GeneratePkgContextInfo.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PROCESS_ROUTER_MAP}}exports.ProcessRouterMapCA=ProcessRouterMapCA;class PackageHapCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_hap_js_1.PackageHap(this.targetService),this.declareDepends=()=>[generate_pkg_module_json_js_1.GeneratePkgModuleJson.name,process_integrated_hsp_js_1.ProcessIntegratedHsp.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_HAP}}exports.PackageHapCA=PackageHapCA;class PackageHqfCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_hqf_js_1.PackageHqf(this.targetService),this.declareDepends=()=>[task_names_js_1.TaskNames.Task.PREPARE_QUICKFIX.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_HQF}}exports.PackageHqfCA=PackageHqfCA;class SignHqfCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new sign_hqf_js_1.SignHqf(this.targetService),this.declareDepends=()=>[task_names_js_1.TaskNames.Task.PACKAGE_HQF.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.SIGN_HQF}}exports.SignHqfCA=SignHqfCA;class GeneratePkgModuleJsonCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new generate_pkg_module_json_js_1.GeneratePkgModuleJson(this.targetService),this.declareDepends=()=>(0,base_pack_hap_task_js_1.packageHapDepends)(this.targetService),this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_PKG_MODULE_JSON}}exports.GeneratePkgModuleJsonCA=GeneratePkgModuleJsonCA;class PackageHspCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_hsp_js_1.PackageHsp(this.targetService),this.declareDepends=()=>[generate_pkg_module_json_js_1.GeneratePkgModuleJson.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_HSP}}exports.PackageHspCA=PackageHspCA;class SignHspCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new sign_hsp_js_1.SignHsp(this.targetService),this.declareDepends=()=>[package_hsp_js_1.PackageHsp.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.SIGN_HSP}}exports.SignHspCA=SignHspCA;class PackageSignHarCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_sign_har_js_1.PackageSignHar(this.targetService),this.declareDepends=()=>[package_har_js_1.PackageHar.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.PACKAGE_SIGN_HAR}}exports.PackageSignHarCA=PackageSignHarCA;class SignProjectRemoteHspCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new sign_project_remote_hsp_js_1.SignProjectRemoteHsp(this.targetService),this.declareDepends=()=>[process_integrated_hsp_js_1.ProcessIntegratedHsp.name,pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.SIGN_PROJECT_REMOTE_HSP}}exports.SignProjectRemoteHspCA=SignProjectRemoteHspCA;class SignModuleRemoteHspCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new sign_module_remote_hsp_js_1.SignModuleRemoteHsp(this.targetService),this.declareDepends=()=>{const e=this.targetService.getModuleService().getProjectModel().getRemoteHspPath();return fse.existsSync(e)?[sign_project_remote_hsp_js_1.SignProjectRemoteHsp.name,process_integrated_hsp_js_1.ProcessIntegratedHsp.name]:[process_integrated_hsp_js_1.ProcessIntegratedHsp.name,pre_build_js_1.PreBuild.name]},this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.SIGN_MODULE_REMOTE_HSP}}exports.SignModuleRemoteHspCA=SignModuleRemoteHspCA;class ProcessIntegratedHspCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new process_integrated_hsp_js_1.ProcessIntegratedHsp(this.targetService),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.PROCESS_INTEGRATED_HSP}}exports.ProcessIntegratedHspCA=ProcessIntegratedHspCA;class PackageSharedHarCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_shared_har_js_1.PackageSharedHar(this.targetService),this.declareDepends=()=>[task_names_js_1.TaskNames.Task.PREPARE_SHARED_HAR_RES.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_SHARED_HAR}}exports.PackageSharedHarCA=PackageSharedHarCA;class PrepareSharedHarResCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new prepare_shared_har_res_js_1.PrepareSharedHarRes(this.targetService),this.declareDepends=()=>[this.targetService.getTargetData().getTargetName()===common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET?"OhosTestCompileArkTS":"CompileArkTS",task_names_js_1.TaskNames.Task.DO_NATIVE_STRIP.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PREPARE_SHARED_HAR_RES}}exports.PrepareSharedHarResCA=PrepareSharedHarResCA;class PackageSharedTgzCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new package_shared_tgz_js_1.PackageSharedTgz(this.targetService),this.declareDepends=()=>[sign_hsp_js_1.SignHsp.name,package_shared_har_js_1.PackageSharedHar.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_SHARED_TGZ}}exports.PackageSharedTgzCA=PackageSharedTgzCA;class PreviewCompileResourceCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new preview_compile_resource_js_1.PreviewCompileResource(this.targetService),this.declareDepends=()=>[task_names_js_1.TaskNames.Task.PREVIEW_PROCESS_RESOURCE.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PREVIEW_COMPILE_RESOURCE}}exports.PreviewCompileResourceCA=PreviewCompileResourceCA;class PreviewUpdateAssetsCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new preview_update_assets_js_1.PreviewUpdateAssets(this.targetService),this.declareDepends=()=>["buildPreviewerResource"],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PREVIEW_UPDATE_ASSETS,this.afterConfigure=()=>{this.depends=this.declareDepends().map((e=>`${this.node.getName()}:${e}`))}}}exports.PreviewUpdateAssetsCA=PreviewUpdateAssetsCA;class ReplacePreviewerPageCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new replace_previewer_page_js_1.ReplacePreviewerPage(this.targetService),this.declareDepends=()=>{const e=[preview_hook_compile_resource_js_1.PreviewHookCompileResource.name];return"true"===hvigor_1.hvigorCore.getExtraConfig().get(inject_const_js_1.InjectConst.PREVIEWER_COMPILE_RES_INC)&&e.push(copy_preview_profile_js_1.CopyPreviewProfile.name),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.REPLACE_PREVIEWER_PAGES}}exports.ReplacePreviewerPageCA=ReplacePreviewerPageCA;class CopyPreviewProfileCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new copy_preview_profile_js_1.CopyPreviewProfile(this.targetService),this.declareDepends=()=>[preview_hook_compile_resource_js_1.PreviewHookCompileResource.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.COPY_PREVIEWER_PROFILE}}exports.CopyPreviewProfileCA=CopyPreviewProfileCA;class ReplaceUnitTestIndexFileCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new replace_unit_test_index_file_js_1.ReplaceUnitTestIndexFile(this.targetService),this.declareDepends=()=>[compile_resource_js_1.CompileResource.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.REPLACE_UNIT_TEST_INDEX_FILE}}exports.ReplaceUnitTestIndexFileCA=ReplaceUnitTestIndexFileCA;class BuildUnitTestHookCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new build_unit_test_hook_js_1.BuildUnitTestHook(this.targetService,!1),this.declareDepends=()=>{const e=[generate_loader_json_js_1.GenerateLoaderJson.name,replace_unit_test_index_file_js_1.ReplaceUnitTestIndexFile.name];return e.push(pre_check_syscap_js_1.PreCheckSyscap.name),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.BUILD_UNIT_TEST_RES}}exports.BuildUnitTestHookCA=BuildUnitTestHookCA;class SignHapCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new sign_hap_js_1.SignHap(this.targetService),this.declareDepends=()=>[this.isFa?legacy_package_hap_js_1.LegacyPackageHap.name:package_hap_js_1.PackageHap.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.SIGN_HAP}}exports.SignHapCA=SignHapCA;class PreCheckSyscapCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new pre_check_syscap_js_1.PreCheckSyscap(this.targetService,task_names_js_1.TaskNames.CommonTask.PRE_CHECK_SYSCAP),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.PRE_CHECK_SYSCAP}}exports.PreCheckSyscapCA=PreCheckSyscapCA;class SyscapTransformCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.provider=()=>new syscap_transform_js_1.SyscapTransform(this.targetService),this.declareDepends=()=>[pre_check_syscap_js_1.PreCheckSyscap.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.SYSCAP_TRANSFORM}}exports.SyscapTransformCA=SyscapTransformCA;class PackageHarCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>{const e=[process_obfuscation_files_js_1.ProcessObfuscationFiles.name,task_names_js_1.TaskNames.Task.CACHE_NATIVE_LIBS.name],s=this.targetService.getSdkInfo().hasRollUpPluginInEtsLoader;return e.push(this.targetService.getModuleService().getModuleModel().isOhpmProject()?task_names_js_1.TaskNames.Task.PROCESS_OH_PACKAGE_JSON.name:task_names_js_1.TaskNames.Task.PROCESS_PACKAGE_JSON.name),e.push(this.targetService.isOpenSource()||s?"HarCompileArkTS":"HarBuildArkTS"),e.push(process_integrated_hsp_js_1.ProcessIntegratedHsp.name),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PACKAGE_HAR,this.provider=()=>new package_har_js_1.PackageHar(this.targetService)}}exports.PackageHarCA=PackageHarCA;class ProcessOhPackageJsonCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PROCESS_OH_PACKAGE_JSON,this.provider=()=>new process_oh_package_json_js_1.ProcessOhPackageJson(this.targetService)}}exports.ProcessOhPackageJsonCA=ProcessOhPackageJsonCA;class ProcessPackageJsonCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[pre_build_js_1.PreBuild.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.PROCESS_PACKAGE_JSON,this.provider=()=>new process_package_json_js_1.ProcessPackageJson(this.targetService)}}exports.ProcessPackageJsonCA=ProcessPackageJsonCA;class ArkLinterCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>{const e=[process_profile_js_1.ProcessProfile.name];return(0,task_util_js_1.limitMinApiVersion)(this.targetService.getTargetData(),sdk_const_js_1.ApiVersion.API_VERSION_9)&&e.push(task_names_js_1.TaskNames.CommonTask.CREATE_HAR_BUILD_PROFILE.name),e},this.declareTaskDetail=()=>({name:"LintArkTS"}),this.provider=()=>new ark_linter_js_1.ArkLinter(this.targetService)}}exports.ArkLinterCA=ArkLinterCA;class ProcessObfuscationFilesCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[compile_resource_js_1.CompileResource.name],this.declareTaskDetail=()=>({name:process_obfuscation_files_js_1.ProcessObfuscationFiles.name}),this.provider=()=>new process_obfuscation_files_js_1.ProcessObfuscationFiles(this.targetService)}}exports.ProcessObfuscationFilesCA=ProcessObfuscationFilesCA;class GenerateMetadataCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>{const e=[pre_build_js_1.PreBuild.name];this.targetService.getModuleService().getHspModuleDependencyNames().forEach((s=>{var r;for(const a of[this.targetService.getTargetData().getTargetName(),common_const_js_1.DefaultTargetConst.DEFAULT_TARGET]){const t=this.targetService.getTargetData().findTargetDataByName(s,a);if(void 0===t)continue;let _=`${t.getTargetName()}@${task_names_js_1.TaskNames.Task.GENERATE_METADATA.name}`;(null===(r=this.node.findModuleByName(s))||void 0===r?void 0:r.getTaskContainer().hasTask(_))&&(_=`${s}:${_}`,e.push(_))}}));const s=this.targetService.getModuleService().getProjectModel().getRemoteHspPath(),r=this.targetService.getTargetData().getModuleModel().getRemoteHspPath(),a=this.node.getName(),t=global_project_data_service_js_1.GlobalProjectDataService.getInstance().getModuleRemoteHspPromise().has(a);return(fse.existsSync(s)||fse.existsSync(r))&&(t||(global_project_data_service_js_1.GlobalProjectDataService.getInstance().setModuleRemoteHspPromise(a),e.push(sign_module_remote_hsp_js_1.SignModuleRemoteHsp.name))),e},this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.GENERATE_METADATA,this.provider=()=>new generate_metadata_js_1.GenerateMetadata(this.targetService)}}exports.GenerateMetadataCA=GenerateMetadataCA;class MakePackInfoCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[merge_profile_js_1.MergeProfile.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.Task.MAKE_PACK_INFO,this.provider=()=>new make_pack_info_js_1.MakePackInfo(this.targetService)}}exports.MakePackInfoCA=MakePackInfoCA;class UnitTestProcessProfileCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[process_profile_js_1.ProcessProfile.name],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.UNIT_TEST_PROCESS_PROFILE,this.provider=()=>new unit_test_process_profile_js_1.UnitTestProcessProfile(this.targetService)}}exports.UnitTestProcessProfileCA=UnitTestProcessProfileCA;class BuildProfileTaskCA extends task_creator_js_1.TargetTaskCreator{constructor(){super(...arguments),this.declareDepends=()=>[...[pre_build_js_1.PreBuild.name],...getBuildProfileEtsDependencies(this.targetService)],this.declareTaskDetail=()=>task_names_js_1.TaskNames.CommonTask.CREATE_BUILD_PROFILE,this.provider=()=>new build_profile_task_js_1.BuildProfileTask(this.targetService)}}function getBuildProfileEtsDependencies(e){const s=[];hsp_target_utils_js_1.HspTargetUtils.calDepHspTargets(e).forEach(((e,r)=>s.push(`${r}:${e.getTargetName()}@${CommonTask.CREATE_BUILD_PROFILE.name}`)));return har_target_util_js_1.HarTargetUtil.calDepHarTargets(e).forEach(((e,r)=>s.push(`${r}:${e}@${CommonTask.CREATE_HAR_BUILD_PROFILE.name}`))),s}exports.BuildProfileTaskCA=BuildProfileTaskCA,exports.getBuildProfileEtsDependencies=getBuildProfileEtsDependencies;