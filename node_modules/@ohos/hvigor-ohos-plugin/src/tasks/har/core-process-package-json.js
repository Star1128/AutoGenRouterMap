"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CoreProcessPackageJson=exports.packageJsonValidMainField=void 0;const pre_build_js_1=require("../pre-build.js"),ohos_har_task_js_1=require("../task/ohos-har-task.js");class CoreProcessPackageJson extends ohos_har_task_js_1.OhosHarTask{constructor(e,s){super(e,s),this.generatePmDir=this.pathInfo.getGeneratePmDir()}doTaskAction(){this._harExtendInfo.isObfuscatedHar()&&this.getGeneratePackageJsonObj()}getGeneratePackageJsonObj(){const e=this.getPackageJsonValidMainField();exports.packageJsonValidMainField=e;const s=this.getDefaultTypesValueByMainField(e),a=this.packageJsonObj;return a.main=this.replaceMainFieldSuffix(e),a.types=s,this.addArtifactType(a),a}getDefaultTypesValueByMainField(e){let s;return ohos_har_task_js_1.DEFAULT_MAIN_FILED_FILE_SUFFIX.forEach((a=>{e.endsWith(a)&&(s=e.replace(a,`.d${a}`))})),null!=s?s:"index.d.ets"}initTaskDepends(){this.declareDepends(pre_build_js_1.PreBuild.name)}replaceMainFieldSuffix(e){const s=this.hasUseTsHarField();for(const a of ohos_har_task_js_1.DEFAULT_MAIN_FILED_FILE_SUFFIX){if(s)return e.replace(a,".ts");if(e.endsWith(a))return e.replace(a,".js")}return e.concat(".js")}}exports.CoreProcessPackageJson=CoreProcessPackageJson;