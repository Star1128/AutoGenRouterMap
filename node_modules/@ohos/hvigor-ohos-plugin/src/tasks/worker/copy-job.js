"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyByCopyOptions=void 0;const fs_extra_1=__importDefault(require("fs-extra")),glob_1=require("glob"),path_1=__importDefault(require("path")),copy_resources_util_js_1=require("../../utils/copy-resources-util.js");async function copyByCopyOptions(e){const t=(0,copy_resources_util_js_1.getCopyOptions)(e),{targets:o=[],...r}=t;let s=[];Array.isArray(o)&&o.length&&(s=await getCopyTargets(o,r));for(const e of s){const{dest:t,src:o}=e;fs_extra_1.default.existsSync(o)&&copyFile(t,o)}}async function getCopyTargets(e,t){const o=[];for(const r of e){const{dest:e,rename:s,src:n,...a}=r,c=glob_1.glob.sync(n,{nodir:!0,...t,...a});if(c.length)for(const t of c){const{base:r}=path_1.default.parse(t);o.push({src:t,dest:path_1.default.join(e,s?renameTarget(r,s,t):r),renamed:s})}}return o}function renameTarget(e,t,o){const r=path_1.default.parse(e);return"string"==typeof t?t:t(r.name,r.ext.replace(".",""),o)}function copyFile(e,t){const o=path_1.default.dirname(e);fs_extra_1.default.ensureDirSync(o),fs_extra_1.default.copyFileSync(t,e)}exports.copyByCopyOptions=copyByCopyOptions;