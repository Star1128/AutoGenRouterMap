"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.submitArkLintWork=exports.submitArkCompileWork=void 0;const hvigor_1=require("@ohos/hvigor"),path_1=__importDefault(require("path")),copy_worker_js_1=require("./copy-worker.js"),job_js_1=require("./job.js");async function submitArkCompileWork(e,t,r,o,i,s){o.level=r.getLevel(),o.projectPath=o.aceModuleRoot,o.buildId=hvigor_1.globalData.buildId;const a=t.submit(e,path_1.default.resolve(__dirname,"./job.js/run"),{workInput:o,callback:i,targetWorkers:s,useReturnVal:!0,hasSideEffects:!1,preludeDeps:["@ohos/hvigor"]});return a.getState()===hvigor_1.TaskState.REJECT&&(r.debug("Worker dispatch failed, running ark compile on main thread."),o.isMainThread=!0,await(0,job_js_1.run)(o).then((e=>{if(e instanceof Error)throw e;i(e)}))),o.isFaMode||o.widgetCompile||await copy_worker_js_1.CopyWorker.submitCopyResourcesWork(e,t,r,o,(()=>{r.debug(`CopyResources is end, endTime: ${process.hrtime.bigint()}`)})),a.getState()===hvigor_1.TaskState.REJECT?null:a.getId()}async function submitArkLintWork(e,t,r,o,i,s){o.level=r.getLevel(),o.projectPath=o.aceModuleRoot;const a=path_1.default.resolve(__dirname,"./job.js/runArkLint"),n={workInput:{config:o,entry:i},hasSideEffects:!1};if(t.submit(e,a,n).getState()===hvigor_1.TaskState.REJECT){const e="perform ark linter",t=s.createSubEvent(e,"");t.start(),r.debug("Worker dispatch failed, running ark lint on main thread."),o.isMainThread=!0,await(0,job_js_1.runArkLint)({config:o,entry:i}),t.stop(),t.setLog(e,hvigor_1.MetricLogType.INFO)}}exports.submitArkCompileWork=submitArkCompileWork,exports.submitArkLintWork=submitArkLintWork;