"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseBuildProfileTask=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),project_ohos_config_manager_js_1=require("../common/global/project-ohos-config-manager.js"),build_profile_utils_js_1=require("../utils/build-profile-utils.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),ohos_hap_task_js_1=require("./task/ohos-hap-task.js"),common_const_js_1=require("../const/common-const.js"),task_util_js_1=require("../utils/task-util.js");class BaseBuildProfileTask extends ohos_hap_task_js_1.OhosHapTask{constructor(e,o){super(e,o),this._log=ohos_logger_js_1.OhosLogger.getLogger(BaseBuildProfileTask.name),this._taskService=e}initDefaultData(){var e,o,t,i,s,l,a,r,u,_;const n=this.projectModel.getAppRes().getAppResOpt(),d=(0,wdk_1.cloneDeep)(null===(e=project_ohos_config_manager_js_1.projectOhosConfigManager.getOverrides())||void 0===e?void 0:e.appOpt),g=this.targetData.getProduct();this.buildProfileData={BUNDLE_NAME:null!==(t=null!==(o=null==d?void 0:d.bundleName)&&void 0!==o?o:this.targetData.getProduct().bundleName)&&void 0!==t?t:this.projectModel.getDefaultBundleName(),BUNDLE_TYPE:null!==(l=null!==(s=null!==(i=null==d?void 0:d.bundleType)&&void 0!==i?i:g.bundleType)&&void 0!==s?s:n.app.bundleType)&&void 0!==l?l:common_const_js_1.BundleType.APP,VERSION_CODE:null!==(r=null!==(a=null==d?void 0:d.versionCode)&&void 0!==a?a:g.versionCode)&&void 0!==r?r:n.app.versionCode,VERSION_NAME:null!==(_=null!==(u=null==d?void 0:d.versionName)&&void 0!==u?u:g.versionName)&&void 0!==_?_:n.app.versionName,TARGET_NAME:this.targetName,PRODUCT_NAME:this.targetData.getProduct().name,BUILD_MODE_NAME:(0,task_util_js_1.getBuildModeName)(),DEBUG:this._taskService.isDebug()}}writeProfileToDir(){const e=this.targetService.getTargetData().getTargetName(),o=this.targetService.getBuildProfileFields(),t=o?{...this.buildProfileData,...o}:{...this.buildProfileData};hvigor_1.LocalFileWriter.getInstance().writeStr(this.pathInfo.getGenerateBuildProfilePath(e),(0,build_profile_utils_js_1.normalizedFileData)(t,this.targetData,this._log))}initTaskDepends(){}doTaskAction(){}}exports.BaseBuildProfileTask=BaseBuildProfileTask;