"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,s,r)}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateMetadata=void 0;const abstract_generate_metadata_js_1=require("./abstract/abstract-generate-metadata.js"),task_names_js_1=require("./common/task-names.js");var Task=task_names_js_1.TaskNames.Task;const hvigor_1=require("@ohos/hvigor"),fse=__importStar(require("fs-extra")),common_const_js_1=require("../const/common-const.js"),global_project_data_service_js_1=require("./service/global-project-data-service.js"),sign_module_remote_hsp_js_1=require("./sign-module-remote-hsp.js");class GenerateMetadata extends abstract_generate_metadata_js_1.AbstractGenerateMetadata{constructor(e){super(e,Task.GENERATE_METADATA),this._hspDepsTarget=new Map}declareInputFiles(){const e=new hvigor_1.FileSet,t=this.sourceSetModel.getModuleTargetRes().getJsonPath();e.addEntry(t);return this.getRelatedEntryJsonList(common_const_js_1.CommonConst.MODULE_JSON5).forEach((t=>{e.addEntry(t)})),e}initTaskDependsForOtherModule(){this.service.getHspModuleDependencyNames().forEach((e=>{var t,a,s;for(const r of[this.targetData.getTargetName(),common_const_js_1.DefaultTargetConst.DEFAULT_TARGET]){const o=this.targetData.findTargetDataByName(e,r);if(void 0===o)continue;const n=`${null!==(t=o.getTargetName())&&void 0!==t?t:common_const_js_1.DefaultTargetConst.DEFAULT_TARGET}@${Task.GENERATE_METADATA.name}`;if(null===(a=this.node.findModuleByName(e))||void 0===a?void 0:a.getTaskByName(n))return this._hspDepsTarget.set(e,null!==(s=null==o?void 0:o.getTargetName())&&void 0!==s?s:common_const_js_1.DefaultTargetConst.DEFAULT_TARGET),void this.declareDepends(n,e)}}))}getDistroFilterObj(e){var t,a;return null!==(a=null===(t=null==e?void 0:e.getTargetOpt().config)||void 0===t?void 0:t.distroFilter)&&void 0!==a?a:void 0}initTaskDepends(){const e=this.service.getProjectModel().getRemoteHspPath(),t=this.moduleModel.getRemoteHspPath(),a=global_project_data_service_js_1.GlobalProjectDataService.getInstance().getModuleRemoteHspPromise().has(this.moduleName);(fse.existsSync(e)||fse.existsSync(t))&&(a||(global_project_data_service_js_1.GlobalProjectDataService.getInstance().setModuleRemoteHspPromise(this.moduleName),this.dependsOn(`${this.targetData.getTargetName()}@${sign_module_remote_hsp_js_1.SignModuleRemoteHsp.name}`)))}}exports.GenerateMetadata=GenerateMetadata;