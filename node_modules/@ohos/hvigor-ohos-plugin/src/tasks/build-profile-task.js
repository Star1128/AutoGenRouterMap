"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildProfileTask=void 0;const task_names_1=require("./common/task-names"),base_build_profile_task_1=require("./base-build-profile-task");var CommonTask=task_names_1.TaskNames.CommonTask;const hvigor_1=require("@ohos/hvigor"),common_const_js_1=require("../const/common-const.js"),task_util_js_1=require("../utils/task-util.js"),project_ohos_config_manager_js_1=require("../common/global/project-ohos-config-manager.js");class BuildProfileTask extends base_build_profile_task_1.BaseBuildProfileTask{constructor(e){super(e,CommonTask.CREATE_BUILD_PROFILE),this.initDefaultData()}declareInputs(){var e;const t=super.declareInputs().set(common_const_js_1.CommonConst.BUILD_MODE,this.targetService.getBuildMode());t.set(common_const_js_1.CommonConst.BUILD_MODE_NAME,(0,task_util_js_1.getBuildModeName)());const o=this.targetService.getBuildProfileFields();return o&&t.set(common_const_js_1.CommonConst.BUILD_PROFILE_FIELDS,JSON.stringify(o)),t.set("projectOhosConfigAppOpt",JSON.stringify(null===(e=project_ohos_config_manager_js_1.projectOhosConfigManager.getOverrides())||void 0===e?void 0:e.appOpt)),t}declareInputFiles(){const e=this.service.getProjectModel().getAppRes();return(new hvigor_1.FileSet).addEntry(e.getJsonPath()).addEntry(this.projectModel.getProfilePath())}declareOutputFiles(){const e=this.targetService.getTargetData().getTargetName(),t=this.pathInfo.getGenerateBuildProfilePath(e);return super.declareOutputFiles().addEntry(t)}doTaskAction(){this.writeProfileToDir()}}exports.BuildProfileTask=BuildProfileTask;