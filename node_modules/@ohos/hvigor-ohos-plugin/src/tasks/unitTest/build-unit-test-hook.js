"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildUnitTestHook=void 0;const path_1=__importDefault(require("path")),common_const_js_1=require("../../const/common-const.js"),task_names_js_1=require("../common/task-names.js"),generate_loader_json_js_1=require("../generate-loader-json.js"),legacy_compile_resource_js_1=require("../legacy-tasks/legacy-compile-resource.js"),legacy_generate_js_manifest_js_1=require("../legacy-tasks/legacy-generate-js-manifest.js"),legacy_generate_loader_json_js_1=require("../legacy-tasks/legacy-generate-loader-json.js"),legacy_process_resource_js_1=require("../legacy-tasks/legacy-process-resource.js"),pre_check_syscap_js_1=require("../pre-check-syscap.js"),module_task_service_js_1=require("../service/module-task-service.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js"),replace_unit_test_index_file_js_1=require("./replace-unit-test-index-file.js");class BuildUnitTestHook extends ohos_hap_task_js_1.OhosHapTask{constructor(e,s){var t;super(e,task_names_js_1.TaskNames.Task.BUILD_UNIT_TEST_RES),this.isFaMode=s,this.syscapJsonPath=path_1.default.resolve(null===(t=this.service.getModuleModel())||void 0===t?void 0:t.getSourceRootByTargetName(),common_const_js_1.CommonConst.SYSCAP_JSON)}doTaskAction(){}initTaskDepends(){this.isFaMode?(this.declareDepends(legacy_generate_loader_json_js_1.LegacyGenerateLoaderJson.name),this.declareDepends(legacy_generate_js_manifest_js_1.LegacyGenerateJsManifest.name),this.getLegacyUnitTestCompileRes()):(this.declareDepends(generate_loader_json_js_1.GenerateLoaderJson.name),this.declareDepends(replace_unit_test_index_file_js_1.ReplaceUnitTestIndexFile.name)),this.declareDepends(pre_check_syscap_js_1.PreCheckSyscap.name)}getLegacyUnitTestCompileRes(){const e=this.service.getRelatedEntryModules(),s=this.service.getModuleModel().getModuleType();if(module_task_service_js_1.ModuleTaskService.checkEntryModules(s,e))for(const s of e)this.createTaskAndDepends(s);else this.createTaskAndDepends()}createTaskAndDepends(e){const s=new legacy_process_resource_js_1.LegacyProcessResource(this.targetService,e),t=new legacy_compile_resource_js_1.LegacyCompileResource(this.targetService,e);this.module.registry(s),this.module.registry(t),s.initTaskDepends(),t.initTaskDepends(),this.declareDepends(t.getName())}}exports.BuildUnitTestHook=BuildUnitTestHook;