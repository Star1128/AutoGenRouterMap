"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,o){void 0===o&&(o=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,o,n)}:function(e,t,s,o){void 0===o&&(o=s),e[o]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnitTestProcessProfile=void 0;const task_names_js_1=require("../common/task-names.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js");var CommonTask=task_names_js_1.TaskNames.CommonTask;const fse=__importStar(require("fs-extra")),path_1=__importDefault(require("path")),common_const_js_1=require("../../const/common-const.js"),json_util_js_1=require("../../utils/json-util.js"),process_profile_js_1=require("../process-profile.js");class UnitTestProcessProfile extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,CommonTask.UNIT_TEST_PROCESS_PROFILE),this.processProfileModuleJsonPath=this.pathInfo.getIntermediatesProcessProfile()}initTaskDepends(){this.declareDepends(process_profile_js_1.ProcessProfile.name)}doTaskAction(){var e;const t=path_1.default.resolve(this.pathInfo.getModuleBuildPath(),common_const_js_1.UnitTestConst.TEST_ABILITY_ETS_PATH);if(!fse.existsSync(t))return;const s=(0,json_util_js_1.getJson5Obj)(this.processProfileModuleJsonPath);let o=null===(e=null==s?void 0:s.module)||void 0===e?void 0:e.abilities;const n=this.targetService.getModuleService().getModuleModel();if(!(null==o?void 0:o.length)){if(!n.isHspModule()&&!n.isHarModule())return;o=s.module.abilities=[]}(n.isHspModule()||n.isHarModule())&&(s.module.deliveryWithInstall=n.isHarModule(),n.isHarModule()&&(s.module.type="entry",s.app.icon=common_const_js_1.CommonConst.ICON,s.app.label=common_const_js_1.CommonConst.LABEL));const{startWindowIcon:r,startWindowBackground:i}=(null==o?void 0:o[0])||{startWindowIcon:"startIcon",startWindowBackground:"#FFFFFF"},a={name:common_const_js_1.UnitTestConst.TEST_ABILITY,srcEntrance:common_const_js_1.UnitTestConst.ENTRY_TEST_ABILITY_PATH,startWindowIcon:r,startWindowBackground:i};o.push(a),fse.outputJSONSync(this.processProfileModuleJsonPath,s,{spaces:"\t"})}}exports.UnitTestProcessProfile=UnitTestProcessProfile;