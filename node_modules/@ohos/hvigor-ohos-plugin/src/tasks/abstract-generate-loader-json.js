"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractGenerateLoaderJson=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),build_directory_const_js_1=require("../const/build-directory-const.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js"),ohos_hap_task_js_1=require("./task/ohos-hap-task.js");class AbstractGenerateLoaderJson extends ohos_hap_task_js_1.OhosHapTask{constructor(t,e){super(t,e),this._log=ohos_logger_js_1.OhosLogger.getLogger(AbstractGenerateLoaderJson.name),this.workerConfig=this.getWorkerConfig(),this.modulePathMap=this.getModulePathMap(),this.projectRootPath=this.service.getProjectModel().getProjectDir()}declareInputs(){const t=(new Map).set("projectRootPath",this.projectRootPath).set("modulePathMap",JSON.stringify(this.modulePathMap));return void 0!==this.workerConfig&&t.set("workerConfig",JSON.stringify(this.workerConfig)),t}beforeTask(){const t=path_1.default.resolve(this.targetData.getPathInfo().getIntermediatesLoaderPath(),build_directory_const_js_1.BuildArtifactConst.LOADER_JSON);fs_extra_1.default.existsSync(t)&&fs_extra_1.default.removeSync(t)}getWorkerConfig(){const t=this.targetService.getWorkerConfig();return 0===t.length?void 0:t}getModulePathMap(){const t={};return this.projectModel.getProject().getSubModules().forEach(((e,o)=>{t[o]=e.getNodeDir()})),t}}exports.AbstractGenerateLoaderJson=AbstractGenerateLoaderJson;