"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LegacyMakePackInfo=void 0;const ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js"),legacy_merge_profile_js_1=require("./legacy-merge-profile.js");var LegacyFATask=task_names_js_1.TaskNames.LegacyFATask;const hvigor_1=require("@ohos/hvigor"),device_type_const_js_1=require("../../const/device-type-const.js"),abstract_make_pack_info_js_1=require("../abstract-make-pack-info.js");class LegacyMakePackInfo extends abstract_make_pack_info_js_1.AbstractMakePackInfo{constructor(e){super(e,LegacyFATask.MAKE_PACK_INFO),this.log=ohos_logger_js_1.OhosLogger.getLogger(LegacyMakePackInfo.name)}declareInputFiles(){const e=this.targetService.getTargetData().getModuleSourceSetModel().getLegacyModuleTargetRes().getJsonPath();return(new hvigor_1.FileSet).addEntry(e)}initTaskDepends(){this.declareDepends(legacy_merge_profile_js_1.LegacyMergeProfile.name)}doTaskAction(){const e=this.moduleModel.getJsonObjByTargetName(this.targetName),t={bundleName:e.app.bundleName,version:e.app.version};this.doMakePackInfo(this.log,t,e.app.apiVersion)}getModuleObj(e,t,a,s){const i=t.getJsonObjByTargetName(s);return{mainAbility:i.module.mainAbility,deviceType:e,abilities:this.processAbilities(i.module.abilities),distro:i.module.distro,apiVersion:null!=a?a:i.app.apiVersion}}getPackageObj(e,t,a,s){if(this.targetData.isSingleDeviceTypeTarget())return[{deviceType:e.getTargetDeviceType(),moduleType:t.module.distro.moduleType,deliveryWithInstall:t.module.distro.deliveryWithInstall,name:a}];const i=this.targetData.getTargetDeviceType().filter((e=>device_type_const_js_1.DeviceTypeConst.LITE_DEVICES.includes(e)));return[{deviceType:this.targetData.getTargetDeviceType().filter((e=>!device_type_const_js_1.DeviceTypeConst.LITE_DEVICES.includes(e))),moduleType:t.module.distro.moduleType,deliveryWithInstall:t.module.distro.deliveryWithInstall,name:a},{deviceType:i,moduleType:t.module.distro.moduleType,deliveryWithInstall:t.module.distro.deliveryWithInstall,name:s}]}}exports.LegacyMakePackInfo=LegacyMakePackInfo;