"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MergeNodeAssets=void 0;const hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),common_const_js_1=require("../../const/common-const.js"),sdk_const_js_1=require("../../const/sdk-const.js"),code_type_enum_js_1=require("../../enum/code-type-enum.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_names_js_1=require("../common/task-names.js"),ohos_hap_task_js_1=require("../task/ohos-hap-task.js"),ohosTestTargetName=common_const_js_1.DefaultTargetConst.OHOS_TEST_TARGET;class MergeNodeAssets extends ohos_hap_task_js_1.OhosHapTask{constructor(e){super(e,task_names_js_1.TaskNames.LegacyFATask.MERGE_NODE_ASSETS),this._log=ohos_logger_js_1.OhosLogger.getLogger(MergeNodeAssets.name),this.intermediatesOutPath=this.pathInfo.getInterMediatesLoaderOutPath(),this.intermediatesAssetsPath=path_1.default.resolve(this.pathInfo.getIntermediatesFaAssetsPath(this.targetData.getProduct()),code_type_enum_js_1.CodeType.JS)}declareInputFiles(){const e=new hvigor_1.FileSet,t=this.moduleModel.getSourceSetByTargetName(this.targetName).getCodeMap().get(code_type_enum_js_1.CodeType.ETS),s=this.moduleModel.getSourceSetByTargetName(this.targetName).getCodeMap().get(code_type_enum_js_1.CodeType.JS);return(t||s)&&this.targetData.hasRichDeviceInTarget()&&e.addEntry(this.intermediatesOutPath,{isDirectory:!0}),e}declareOutputFiles(){return(new hvigor_1.FileSet).addEntry(this.intermediatesAssetsPath,{isDirectory:!0})}beforeTask(){fs_extra_1.default.removeSync(this.intermediatesAssetsPath)}doTaskAction(){const e=path_1.default.resolve(this.intermediatesOutPath,code_type_enum_js_1.CodeType.ETS);fs_extra_1.default.existsSync(e)&&fs_extra_1.default.copySync(e,this.intermediatesAssetsPath);const t=path_1.default.resolve(this.intermediatesOutPath,code_type_enum_js_1.CodeType.JS);fs_extra_1.default.existsSync(t)&&fs_extra_1.default.copySync(t,this.intermediatesAssetsPath)}initTaskDepends(){const e=fs_extra_1.default.existsSync(path_1.default.resolve(this.sdkInfo.getEtsLoader(),sdk_const_js_1.ToolChainsConst.ROLL_UP_CONFIG_FILE)),t=fs_extra_1.default.existsSync(path_1.default.resolve(this.sdkInfo.getJsLoader(),sdk_const_js_1.ToolChainsConst.ROLL_UP_CONFIG_FILE));this._log.debug(e?"compile ArkTS with rollup":"compile ArkTS with webpack"),this._log.debug(t?"compile ace js with rollup":"compile ace js with webpack"),this.targetName===ohosTestTargetName?(this.declareDepends(e?"LegacyOhosTestCompileArkTS":"LegacyOhosTestBuildArkTS"),this.declareDepends(t?"LegacyOhosTestCompileJS":"LegacyOhosTestBuildJS")):(this.declareDepends(e?"LegacyCompileArkTS":"LegacyBuildArkTS"),this.declareDepends(t?"LegacyCompileJS":"LegacyBuildJS"))}}exports.MergeNodeAssets=MergeNodeAssets;