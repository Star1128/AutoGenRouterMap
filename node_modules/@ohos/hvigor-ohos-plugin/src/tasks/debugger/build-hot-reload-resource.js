"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t);var s=Object.getOwnPropertyDescriptor(o,t);s&&!("get"in s?!o.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return o[t]}}),Object.defineProperty(e,r,s)}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(o,e,t);return __setModuleDefault(o,e),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BuildHotReloadResource=void 0;const os=__importStar(require("os")),find_target_product_js_1=require("../../common/find-target-product.js"),compile_mode_enum_js_1=require("../../enum/compile-mode-enum.js"),hap_extra_info_js_1=require("../../project/data/hap-extra-info.js"),error_url_js_1=require("../../utils/error-url.js"),ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),task_util_js_1=require("../../utils/task-util.js"),task_names_js_1=require("../common/task-names.js"),compile_resource_js_1=require("../compile-resource.js"),generate_loader_json_js_1=require("../generate-loader-json.js"),abstract_module_hook_task_js_1=require("../hook/abstract-module-hook-task.js");class BuildHotReloadResource extends abstract_module_hook_task_js_1.AbstractModuleHookTask{constructor(e){super(e,!1,task_names_js_1.TaskNames.CommonHookTask.BUILD_HOT_RELOAD_RES),this._log=ohos_logger_js_1.OhosLogger.getLogger(BuildHotReloadResource.name),this.registryAction=()=>{const e=this._moduleService.getModuleModel(),o=(0,find_target_product_js_1.findTargetProduct)(e.getParentProject()),t=e.getCompileApiMetaByProduct(o.name).version;return()=>{(e.getCompileMode(o)!==compile_mode_enum_js_1.CompileModeEnum.ES_MODULE||e.getApiType()!==hap_extra_info_js_1.ApiType.STAGE||t<9)&&this._log._buildError("Hot reload is only supported for esmodule mode in the stage model.")._detail(`Please check attribute apiType and compileMode from build-profile.json5. For details about hot reload, ${os.EOL}see ${error_url_js_1.ErrorUrl.ERROR_URL.hotReload}.`)._file(e.getProfilePath())._printErrorAndExit(e.getName()),this._log.debug("Hot reload resources ready.")}}}initTaskDepends(e){this.dependsOn((0,task_util_js_1.resolveHookDependency)(generate_loader_json_js_1.GenerateLoaderJson.name,e.getTargetData().getTargetName())),this.dependsOn((0,task_util_js_1.resolveHookDependency)(compile_resource_js_1.CompileResource.name,e.getTargetData().getTargetName()))}}exports.BuildHotReloadResource=BuildHotReloadResource;