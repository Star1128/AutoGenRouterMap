"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TaskInitializer=void 0;const hvigor_1=require("@ohos/hvigor"),module_type_enum_js_1=require("../enum/module-type-enum.js"),arkts_task_initializer_js_1=require("../tasks/manager/arkts-task-initializer.js"),global_task_creation_manager_js_1=require("../tasks/manager/global-task-creation-manager.js"),native_task_initializer_js_1=require("../tasks/manager/native-task-initializer.js"),resource_task_initializer_js_1=require("../tasks/manager/resource-task-initializer.js"),task_creation_manager_js_1=require("../tasks/task-creation-manager.js"),task_creator_js_1=require("../tasks/task-creator.js"),ohos_logger_js_1=require("./log/ohos-logger.js"),log=new ohos_logger_js_1.OhosLogger("TaskInitialization");class TaskInitializer{static initializeHap(e){const a=process.hrtime(),r=e.getTaskService(),t=e.getModuleModel().getModule(),s=new task_creator_js_1.TaskCreatorManager(t.getTaskContainer());return s.registry(new global_task_creation_manager_js_1.AssembleHapCA(r,e)),this.commonHap(e,s),this.initializeTargetTasks(e,s),log.debug(`Module ${t.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`),s}static initializeHsp(e){const a=process.hrtime(),r=e.getTaskService(),t=e.getModuleModel().getModule(),s=new task_creator_js_1.TaskCreatorManager(t.getTaskContainer());return s.registry(new global_task_creation_manager_js_1.AssembleHspCA(r,e)),s.registry(new global_task_creation_manager_js_1.GenOnDeviceTestHapCA(r,e)),this.commonHap(e,s),this.initializeTargetTasks(e,s),log.debug(`Module ${t.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`),s}static initializeHar(e){const a=process.hrtime(),r=e.getTaskService(),t=e.getModuleModel().getModule(),s=new task_creator_js_1.TaskCreatorManager(t.getTaskContainer());return s.registry(new global_task_creation_manager_js_1.AssembleHarCA(r,e)),s.registry(new global_task_creation_manager_js_1.LibraryBuildPreviewerResCA(r,e)),s.registry(new global_task_creation_manager_js_1.GeneratedBuildProfileCA(r,e,!1,!0)),this.initializeCommonHookTasks(e,s),s.registry(new global_task_creation_manager_js_1.GenOnDeviceTestHapCA(r,e)),this.initializeTargetTasks(e,s),log.debug(`Module ${t.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`),s}static commonHap(e,a){const r=e.getTaskService();a.registry(new global_task_creation_manager_js_1.BuildPreviewerResCA(r,e)),a.registry(new global_task_creation_manager_js_1.HotReloadBuildCA(r,e)),a.registry(new global_task_creation_manager_js_1.GeneratedBuildProfileCA(r,e,!1,!1)),a.registry(new global_task_creation_manager_js_1.AssembleHqfCA(r,e)),this.initializeCommonHookTasks(e,a)}static initializeCommonHookTasks(e,a){const r=e.getTaskService();a.registry(new global_task_creation_manager_js_1.CompileNativeHookCA(r,e)),a.registry(new global_task_creation_manager_js_1.PreviewBuildCA(r,e)),a.registry(new global_task_creation_manager_js_1.UnitTestBuildCA(r,e)),a.registry(new global_task_creation_manager_js_1.TestCA(r,e)),a.registry(new global_task_creation_manager_js_1.BuildHotReloadResourceCA(r,e)),a.registry(new global_task_creation_manager_js_1.CleanCA(r,e)),a.registry(new global_task_creation_manager_js_1.DeviceTestHookCA(r,e))}static initializeTargetTasks(e,a){e.getNeedExecTargetServiceList().forEach((e=>this.targetInitialize(e,a)))}static targetInitialize(e,a){this.hapTasksInitialize(e,a),this.hspTasksInitialize(e,a),this.harTasksInitialize(e,a),this.initializeCommonTargetTasks(e,a)}static hapTasksInitialize(e,a){const r=e.getModuleService().getModuleModel().getModuleType();r!==module_type_enum_js_1.ModuleType.Entry&&r!==module_type_enum_js_1.ModuleType.Feature||(this.tasksInitialize(e,a),a.registry(new task_creation_manager_js_1.PackageHapCA(e)),a.registry(new task_creation_manager_js_1.SignHapCA(e)))}static hspTasksInitialize(e,a){e.getModuleService().getModuleModel().getModuleType()===module_type_enum_js_1.ModuleType.Shared&&(this.tasksInitialize(e,a),a.registry(new task_creation_manager_js_1.PackageSharedHarCA(e)),a.registry(new task_creation_manager_js_1.PrepareSharedHarResCA(e)),a.registry(new task_creation_manager_js_1.PackageSharedTgzCA(e)),a.registry(new task_creation_manager_js_1.PackageHspCA(e)),a.registry(new task_creation_manager_js_1.SignHspCA(e)),a.registry(new task_creation_manager_js_1.SignHapCA(e)),a.registry(new task_creation_manager_js_1.PackageHapCA(e)))}static harTasksInitialize(e,a){e.getModuleService().getModuleModel().getModuleType()===module_type_enum_js_1.ModuleType.Har&&(a.registry(new task_creation_manager_js_1.PackageHarCA(e)),a.registry(new task_creation_manager_js_1.PackageSignHarCA(e)),a.registry(new task_creation_manager_js_1.ArkLinterCA(e)),a.registry(new task_creation_manager_js_1.ProcessObfuscationFilesCA(e)),a.registry(new task_creation_manager_js_1.ProcessOhPackageJsonCA(e)),a.registry(new task_creation_manager_js_1.ProcessPackageJsonCA(e)),a.registry(new task_creation_manager_js_1.HarBuildProfileTaskCA(e)),a.registry(new task_creation_manager_js_1.SyscapTransformCA(e)),a.registry(new task_creation_manager_js_1.MakePackInfoCA(e)),a.registry(new task_creation_manager_js_1.GenerateMetadataCA(e)),a.registry(new task_creation_manager_js_1.PackageHapCA(e)),a.registry(new task_creation_manager_js_1.SignHapCA(e)))}static tasksInitialize(e,a){a.registry(new task_creation_manager_js_1.SyscapTransformCA(e)),a.registry(new task_creation_manager_js_1.MakePackInfoCA(e)),a.registry(new task_creation_manager_js_1.GenerateMetadataCA(e)),a.registry(new task_creation_manager_js_1.PackageHqfCA(e)),a.registry(new task_creation_manager_js_1.SignHqfCA(e))}static initializeCommonTargetTasks(e,a){(0,arkts_task_initializer_js_1.initializeArkTsTasks)(e,a),(0,resource_task_initializer_js_1.initResourceTasks)(a,e),(0,native_task_initializer_js_1.initNativeTasks)(a,e),a.registry(new task_creation_manager_js_1.PreBuildCA(e)),a.registry(new task_creation_manager_js_1.GenerateLoaderJsonCA(e)),a.registry(new task_creation_manager_js_1.ProcessProfileCA(e)),a.registry(new task_creation_manager_js_1.MergeProfileCA(e)),a.registry(new global_task_creation_manager_js_1.PreviewHookCompileResourceCA(e)),a.registry(new task_creation_manager_js_1.BuildProfileTaskCA(e)),a.registry(new task_creation_manager_js_1.PreviewUpdateAssetsCA(e)),a.registry(new task_creation_manager_js_1.BuildUnitTestHookCA(e)),a.registry(new task_creation_manager_js_1.ReplaceUnitTestIndexFileCA(e)),a.registry(new task_creation_manager_js_1.UnitTestProcessProfileCA(e)),a.registry(new task_creation_manager_js_1.ReplacePreviewerPageCA(e)),a.registry(new task_creation_manager_js_1.CopyPreviewProfileCA(e)),a.registry(new task_creation_manager_js_1.PreviewCompileResourceCA(e)),a.registry(new task_creation_manager_js_1.OhosTestCopyMockConfigJsonCA(e)),a.registry(new task_creation_manager_js_1.SignProjectRemoteHspCA(e)),a.registry(new task_creation_manager_js_1.SignModuleRemoteHspCA(e)),a.registry(new task_creation_manager_js_1.PreCheckSyscapCA(e)),a.registry(new task_creation_manager_js_1.GenerateUnitTestTemplateCA(e)),a.registry(new task_creation_manager_js_1.GenerateOhosTestTemplateCA(e)),a.registry(new task_creation_manager_js_1.GenerateUnitTestResultCA(e)),a.registry(new task_creation_manager_js_1.ProcessRouterMapCA(e)),a.registry(new task_creation_manager_js_1.GenerateDeviceCoverageCA(e)),a.registry(new task_creation_manager_js_1.BeforeGenerateDeviceCoverageCA(e)),a.registry(new task_creation_manager_js_1.GeneratePkgContextInfoCA(e)),a.registry(new task_creation_manager_js_1.ProcessIntegratedHspCA(e)),a.registry(new task_creation_manager_js_1.GeneratePkgModuleJsonCA(e))}}exports.TaskInitializer=TaskInitializer;