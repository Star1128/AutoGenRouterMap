"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.legacyTasksInitialize=exports.legacyCommonHooksInitialize=exports.legacyHarTasksInitialize=exports.legacyHapTasksInitialize=void 0;const hvigor_1=require("@ohos/hvigor"),code_type_enum_js_1=require("../enum/code-type-enum.js"),build_native_with_cmake_js_1=require("../tasks/build-native-with-cmake.js"),build_native_with_ninja_js_1=require("../tasks/build-native-with-ninja.js"),cache_native_libs_js_1=require("../tasks/cache-native-libs.js"),task_names_js_1=require("../tasks/common/task-names.js"),configure_cmake_js_1=require("../tasks/configure-cmake.js"),do_native_strip_js_1=require("../tasks/do-native-strip.js"),ark_linter_js_1=require("../tasks/har/ark-linter.js"),assemble_hap_js_1=require("../tasks/hook/assemble/assemble-hap.js"),assemble_har_js_1=require("../tasks/hook/assemble/assemble-har.js"),compile_native_hook_js_1=require("../tasks/hook/native/compile-native-hook.js"),build_har_previewer_res_js_1=require("../tasks/hook/previewer/build-har-previewer-res.js"),build_previewer_res_js_1=require("../tasks/hook/previewer/build-previewer-res.js"),preview_build_js_1=require("../tasks/hook/previewer/preview-build.js"),legacy_package_har_js_1=require("../tasks/legacy-tasks/har/legacy-package-har.js"),legacy_process_oh_package_json_js_1=require("../tasks/legacy-tasks/har/legacy-process-oh-package-json.js"),legacy_hook_compile_resource_js_1=require("../tasks/legacy-tasks/hook/legacy-hook-compile-resource.js"),legacy_ark_compile_js_1=require("../tasks/legacy-tasks/legacy-ark-compile.js"),legacy_compile_lite_node_js_1=require("../tasks/legacy-tasks/legacy-compile-lite-node.js"),legacy_compile_node_js_1=require("../tasks/legacy-tasks/legacy-compile-node.js"),legacy_gen_lite_source_js_1=require("../tasks/legacy-tasks/legacy-gen-lite-source.js"),legacy_generate_har_js_manifest_js_1=require("../tasks/legacy-tasks/legacy-generate-har-js-manifest.js"),legacy_generate_har_loader_json_js_1=require("../tasks/legacy-tasks/legacy-generate-har-loader-json.js"),legacy_generate_js_manifest_js_1=require("../tasks/legacy-tasks/legacy-generate-js-manifest.js"),legacy_generate_loader_json_js_1=require("../tasks/legacy-tasks/legacy-generate-loader-json.js"),legacy_generate_metadata_js_1=require("../tasks/legacy-tasks/legacy-generate-metadata.js"),legacy_make_pack_info_js_1=require("../tasks/legacy-tasks/legacy-make-pack-info.js"),legacy_merge_profile_js_1=require("../tasks/legacy-tasks/legacy-merge-profile.js"),legacy_ohos_test_ark_compile_js_1=require("../tasks/legacy-tasks/legacy-ohos-test-ark-compile.js"),legacy_ohos_test_compile_node_js_1=require("../tasks/legacy-tasks/legacy-ohos-test-compile-node.js"),legacy_package_hap_js_1=require("../tasks/legacy-tasks/legacy-package-hap.js"),legacy_pre_build_js_1=require("../tasks/legacy-tasks/legacy-pre-build.js"),legacy_previewer_ark_compile_js_1=require("../tasks/legacy-tasks/legacy-previewer-ark-compile.js"),legacy_process_profile_js_1=require("../tasks/legacy-tasks/legacy-process-profile.js"),legacy_sign_lite_bin_js_1=require("../tasks/legacy-tasks/legacy-sign-lite-bin.js"),legacy_syscap_transform_js_1=require("../tasks/legacy-tasks/legacy-syscap-transform.js"),merge_node_assets_js_1=require("../tasks/legacy-tasks/merge-node-assets.js"),pre_check_syscap_js_1=require("../tasks/pre-check-syscap.js"),process_libs_js_1=require("../tasks/process-libs.js"),sign_hap_js_1=require("../tasks/sign-hap.js"),syscap_transform_js_1=require("../tasks/syscap-transform.js"),build_unit_test_hook_js_1=require("../tasks/unitTest/build-unit-test-hook.js"),legacy_unit_test_ark_compile_js_1=require("../tasks/unitTest/legacy-unit-test-ark-compile.js"),unit_test_build_js_1=require("../tasks/unitTest/unit-test-build.js"),validate_sign_js_1=require("../tasks/validate-sign.js"),ohos_logger_js_1=require("./log/ohos-logger.js"),task_util_js_1=require("./task-util.js"),generate_pkg_module_json_1=require("../tasks/generate-pkg-module-json"),log=new ohos_logger_js_1.OhosLogger("TaskInitialization"),legacyHapTasksInitialize=e=>{var s;const a=process.hrtime(),_=null===(s=e.getModuleModel())||void 0===s?void 0:s.getModule();if(!_)return void log.errorMessageExit("Invalid module model.");const r=e.getTaskService();if(!r)return void log.errorMessageExit("Invalid plugin model.");const i=[];i.push(new assemble_hap_js_1.AssembleHap(r,!0)),i.push(new build_previewer_res_js_1.BuildPreviewerRes(r,!0)),i.push(...(0,exports.legacyCommonHooksInitialize)(r)),initializeTargetsTasks(_,e.getNeedExecTargetServiceList(),i),log.debug(`Module ${_.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`)};exports.legacyHapTasksInitialize=legacyHapTasksInitialize;const legacyHarTasksInitialize=e=>{var s;const a=process.hrtime(),_=e.getTaskService();if(!_)return void log.errorMessageExit("Invalid plugin model.");const r=null===(s=e.getModuleModel())||void 0===s?void 0:s.getModule();if(!r)return void log.errorMessageExit("Invalid module model.");const i=[];i.push(new assemble_har_js_1.AssembleHar(_,!0)),i.push(new build_har_previewer_res_js_1.BuildHarPreviewerRes(_,!0)),i.push(...(0,exports.legacyCommonHooksInitialize)(_)),initializeTargetsTasks(r,e.getNeedExecTargetServiceList(),i),log.debug(`Module ${r.getName()} task initialization takes ${(0,hvigor_1.formatTime)(process.hrtime(a))}`)};exports.legacyHarTasksInitialize=legacyHarTasksInitialize;const legacyCommonHooksInitialize=e=>{const s=[];return s.push(new compile_native_hook_js_1.CompileNativeHook(e)),s.push(new preview_build_js_1.PreviewBuild(e,!0)),s.push(new unit_test_build_js_1.UnitTestBuild(e,!0)),s};exports.legacyCommonHooksInitialize=legacyCommonHooksInitialize;const initializeTargetsTasks=(e,s,a)=>{s.forEach((s=>{a.forEach((a=>e.registry(a)&&a.initTaskDepends(s))),(0,exports.legacyTasksInitialize)(e,s)}))},legacyTasksInitialize=(e,s)=>{e.registry(new legacy_pre_build_js_1.LegacyPreBuild(s)),e.registry(new legacy_merge_profile_js_1.LegacyMergeProfile(s)),e.registry(new legacy_generate_js_manifest_js_1.LegacyGenerateJsManifest(s)),e.registry(new legacy_generate_loader_json_js_1.LegacyGenerateLoaderJson(s)),e.registry(new legacy_make_pack_info_js_1.LegacyMakePackInfo(s)),e.registry(new legacy_process_oh_package_json_js_1.LegacyProcessOHPackageJson(s)),e.registry(new legacy_process_profile_js_1.LegacyProcessProfile(s)),(0,task_util_js_1.dynamicResolveResourceTasks)(s,e),e.registry(new legacy_hook_compile_resource_js_1.LegacyHookCompileResource(s)),e.registry(new legacy_generate_har_loader_json_js_1.LegacyGenerateHarLoaderJson(s)),e.registry(new legacy_generate_har_js_manifest_js_1.LegacyGenerateHarJsManifest(s)),e.registry(new legacy_package_hap_js_1.LegacyPackageHap(s)),e.registry(new legacy_package_har_js_1.LegacyPackageHar(s)),e.registry(new legacy_gen_lite_source_js_1.LegacyGenLiteSource(s)),e.registry(new merge_node_assets_js_1.MergeNodeAssets(s)),e.registry(new legacy_compile_lite_node_js_1.LegacyCompileLiteNode(s)),e.registry(new build_unit_test_hook_js_1.BuildUnitTestHook(s,!0)),e.registry(new legacy_generate_metadata_js_1.LegacyGenerateMetadata(s)),e.registry(new legacy_syscap_transform_js_1.LegacySyscapTransform(s)),e.registry(new legacy_sign_lite_bin_js_1.LegacySignLiteBin(s)),e.registry(new validate_sign_js_1.ValidateSigning(s)),e.registry(new legacy_ark_compile_js_1.LegacyArkCompile(s,code_type_enum_js_1.CodeType.ETS,task_names_js_1.TaskNames.LegacyFATask.COMPILE_ARK)),e.registry(new legacy_compile_node_js_1.LegacyCompileNode(s,code_type_enum_js_1.CodeType.ETS,task_names_js_1.TaskNames.LegacyFATask.COMPILE_NODE)),e.registry(new legacy_ark_compile_js_1.LegacyArkCompile(s,code_type_enum_js_1.CodeType.JS,task_names_js_1.TaskNames.LegacyFATask.COMPILE_ARK)),e.registry(new legacy_compile_node_js_1.LegacyCompileNode(s,code_type_enum_js_1.CodeType.JS,task_names_js_1.TaskNames.LegacyFATask.COMPILE_NODE)),e.registry(new legacy_ohos_test_ark_compile_js_1.LegacyOhosTestArkCompile(s,code_type_enum_js_1.CodeType.ETS)),e.registry(new legacy_ohos_test_ark_compile_js_1.LegacyOhosTestArkCompile(s,code_type_enum_js_1.CodeType.JS)),e.registry(new legacy_ohos_test_compile_node_js_1.LegacyOhosTestCompileNode(s,code_type_enum_js_1.CodeType.ETS)),e.registry(new legacy_ohos_test_compile_node_js_1.LegacyOhosTestCompileNode(s,code_type_enum_js_1.CodeType.JS)),e.registry(new legacy_previewer_ark_compile_js_1.LegacyPreviewerArkCompile(s,code_type_enum_js_1.CodeType.ETS,{name:"LegacyPreviewCompile"})),e.registry(new legacy_previewer_ark_compile_js_1.LegacyPreviewerArkCompile(s,code_type_enum_js_1.CodeType.JS,{name:"LegacyPreviewCompile"})),e.registry(new legacy_unit_test_ark_compile_js_1.LegacyUnitTestArkCompile(s,code_type_enum_js_1.CodeType.ETS,{name:"LegacyUnitTest"})),e.registry(new legacy_unit_test_ark_compile_js_1.LegacyUnitTestArkCompile(s,code_type_enum_js_1.CodeType.JS,{name:"LegacyUnitTest"})),e.registry(new build_native_with_cmake_js_1.BuildNativeWithCmake(s)),e.registry(new build_native_with_ninja_js_1.BuildNativeWithNinja(s)),e.registry(new configure_cmake_js_1.ConfigureCmake(s)),e.registry(new process_libs_js_1.ProcessLibs(s)),e.registry(new do_native_strip_js_1.DoNativeStrip(s)),e.registry(new cache_native_libs_js_1.CacheNativeLibs(s)),e.registry(new sign_hap_js_1.SignHap(s)),e.registry(new pre_check_syscap_js_1.PreCheckSyscap(s,task_names_js_1.TaskNames.CommonTask.PRE_CHECK_SYSCAP)),e.registry(new syscap_transform_js_1.SyscapTransform(s)),e.registry(new ark_linter_js_1.ArkLinter(s)),e.registry(new generate_pkg_module_json_1.GeneratePkgModuleJson(s))};exports.legacyTasksInitialize=legacyTasksInitialize;