"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleLogs=exports.OhosLogger=void 0;const hvigor_1=require("@ohos/hvigor"),log4js_1=require("log4js"),os_1=__importDefault(require("os")),util_1=__importDefault(require("util")),error_util_js_1=require("../../error/error-util.js");class OhosLogger extends hvigor_1.HvigorLogger{constructor(e,s){super(e,s),this.messageMap=new Map,this.errList=[]}static getLogger(e){return new OhosLogger(e)}static getLoggerWithDurationId(e,s){return new OhosLogger(e,s)}_buildError(e,s){return s&&this.messageMap.set("code",s),this.messageMap.set("cause",e),this}_solution(e){return this.messageMap.set("solution",e),this}_detail(e){return this.messageMap.set("solution",e),this}_help(e){return this.messageMap.set("help",e),this}_record(){const e=Array.from(this.messageMap.values()),s=util_1.default.format(this._formatLog("root"),...e);this.messageMap.clear(),this.errList.push(s)}_printAllExit(){if(0===this.errList.length)return;for(let e=0;e<this.errList.length-1;e++)this.error(this.errList[e]);const e=this.errList[this.errList.length-1];this.errList=[],this.errorMessageExit(e)}_format(){const e=Array.from(this.messageMap.values()),s=util_1.default.format(this._formatLog("root"),...e);return this.messageMap.clear(),s}_file(e,s=-1,t=-1){let r=`at ${e}`;return s>0&&(r+=`:${s}`,t>0&&(r+=`:${t}`)),this.messageMap.set("file",r),this}_callstack(e){return this.getLevel()===log4js_1.levels.DEBUG&&this.messageMap.set("callstack",e),this}_printDebugCommand(e,s){this.debug(`Use tool [${e}]\n`,s)}_printWarn(e){const s=Array.from(this.messageMap.values());this.warn(this._formatLog(e),...s)}_printError(e){const s=Array.from(this.messageMap.values());this.error(this._formatLog(e),...s)}_printErrorAndExit(e="root"){const s=Array.from(this.messageMap.values());this.errorMessageExit(this._formatLog(e),...s)}_formatLog(e){let s=this.messageMap.has("code")?"[%s]%s":"%s";for(const e of this.messageMap.keys())switch(e){case"solution":s+=`${os_1.default.EOL}\t Detail: %s`;break;case"help":s+=`${os_1.default.EOL}\t Help: %s`;break;case"file":s+=`${os_1.default.EOL}\t %s`;break;case"callstack":s+=`${os_1.default.EOL+os_1.default.EOL}    %s`}return this.messageMap.clear(),s}_errorCode(e){return(0,error_util_js_1.recordDECE)(e),this}}exports.OhosLogger=OhosLogger;const handleLogs=(e,s,t)=>{let r="",o="",a="";const i="[39m";e.filter((e=>t.isLessThanOrEqualTo(e.level))).forEach((e=>{"warn"===e.level&&(r+=`[33mWARN: ${e.msg}${i}${os_1.default.EOL}`),"info"===e.level&&(o+=`[34mINFO: ${e.msg}${i}${os_1.default.EOL}`),"debug"===e.level&&(a+=`DEBUG: ${e.msg}${os_1.default.EOL}`)})),""!==r&&s.log(t,r),""!==o&&s.log(t,o),""!==a&&s.log(t,a)};exports.handleLogs=handleLogs;