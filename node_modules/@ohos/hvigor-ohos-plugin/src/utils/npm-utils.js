"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var c=Object.getOwnPropertyDescriptor(t,i);c&&!("get"in c?!t.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,c)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.execOhpmPack=exports.getNpmPath=exports.isLocalDependency=exports.collectLocalFileDependency=exports.checkHasLocalFileDependency=void 0;const hvigor_1=require("@ohos/hvigor"),hvigor_2=require("@ohos/hvigor"),fse=__importStar(require("fs-extra")),path_1=__importDefault(require("path")),tar_1=__importDefault(require("tar")),file_util_js_1=require("./file-util.js"),isFileSpec=(0,hvigor_2.isWindows)()?/^(?:[.]|~[/]|[/\\]|[a-zA-Z]:)/:/^(?:[.]|~[/]|[/]|[a-zA-Z]:)/,hasSlashes=(0,hvigor_2.isWindows)()?/\\|[/]/:/[/]/,isFileName=/[.](?:tgz|tar.gz|tar)$/i;function checkHasLocalFileDependency(e,t,i){const r=t;return void 0!==r.dependencies&&Object.values(r.dependencies).some((t=>{if(!1!==(null==i?void 0:i.allowInside)&&isLocalDependency(t)&&t){const i=/^file:(.*)/i.test(t)?/^file:(.*)/i.exec(t)[1]:t;return!file_util_js_1.FileUtil.isSubDir(path_1.default.dirname(e),path_1.default.resolve(path_1.default.dirname(e),i))}return isLocalDependency(t)}))}function collectLocalFileDependency(e,t){const i=[],r=t;return void 0===r.dependencies||Object.values(r.dependencies).forEach((t=>{if(isLocalDependency(t)&&t){const r=/^file:(.*)/i.test(t)?/^file:(.*)/i.exec(t)[1]:t;file_util_js_1.FileUtil.isSubDir(path_1.default.dirname(e),path_1.default.resolve(path_1.default.dirname(e),r))&&i.push(r)}})),i}function isLocalDependency(e){return!!e&&(isFileSpec.test(e)||/^file:/i.test(e)||hasSlashes.test(e)||isFileName.test(e))}function getNpmPath(){return process.execPath}async function execOhpmPack(e,t,i,r=!0){const c="execute ohpm packaging command",a=i.createSubEvent(c,"");a.start(),await tar_1.default.create({cwd:e,noDirRecurse:!1,file:t,gzip:!0,prefix:r?"package":void 0},await fse.readdir(e)),a.stop(),a.setLog(c,hvigor_1.MetricLogType.INFO)}exports.checkHasLocalFileDependency=checkHasLocalFileDependency,exports.collectLocalFileDependency=collectLocalFileDependency,exports.isLocalDependency=isLocalDependency,exports.getNpmPath=getNpmPath,exports.execOhpmPack=execOhpmPack;