"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HspTargetUtils=void 0;const task_util_1=require("@ohos/hvigor/src/base/util/task-util"),os_1=__importDefault(require("os")),common_const_js_1=require("../const/common-const.js"),ohos_plugin_id_js_1=require("../plugin/common/ohos-plugin-id.js"),module_task_service_js_1=require("../tasks/service/module-task-service.js"),ohos_logger_1=require("./log/ohos-logger");class HspTargetUtils{static calDepHspTargets(e){var t;const o=new Map,s=e.getTargetData(),r=e.getModuleService(),a=r.getModuleModel(),l=a.getName(),g=null!==(t=(0,task_util_1.getAlignTarget)())&&void 0!==t?t:s.getTargetName(),u=s.getProduct().name;return r.getHspModuleDependencyNames().forEach((e=>{const t=a.getModule().findModuleByName(e);if(!t)return void this._log._buildError(`Unable to find module '${e}'. Make sure module '${e}' exists.`)._printErrorAndExit(l);const r=()=>{const t=`Module '${l}@${g}' depends on shared library module '${e}', `,o=`but neither target '${g}' nor target '${common_const_js_1.DefaultTargetConst.DEFAULT_TARGET}' of module '${e}' is applied to current product '${u}'.${os_1.default.EOL}`,r=`but target '${g}' of module '${e}' is not applied to current product '${u}'.${os_1.default.EOL}`,a=`\tSolution: Apply one of these targets of module '${e}' to product '${u}': ${os_1.default.EOL}\t\t- default`,i=`${os_1.default.EOL}\t\t- ${g}`,_=g===common_const_js_1.DefaultTargetConst.DEFAULT_TARGET?`${t}${r}${a}`:`${t}${o}${a}${i}`;this._log._buildError(`Unable to find target '${s.getTargetName()}' in module '${e}'. Make sure module '${e}' has the same target as module '${l}'.`)._detail(_)._printErrorAndExit(l)},i=t.getPluginById(ohos_plugin_id_js_1.OhosPluginId.OHOS_HSP_PLUGIN).getNeedExecTargetServiceList();0===i.length&&r();const _=[];for(const e of[g,common_const_js_1.DefaultTargetConst.DEFAULT_TARGET]){const t=i.find((t=>t.getTargetData().getTargetName()===e&&(0,module_task_service_js_1.checkHasTargetApplyProduct)(t.getTargetData().getModuleModel(),e,u)));if(void 0!==t){_.push(t.getTargetData());break}}if(0===_.length&&i.length>0){const e=i.find((e=>(0,module_task_service_js_1.checkHasTargetApplyProduct)(e.getModuleService().getModuleModel(),e.getTargetData().getTargetName(),u)));e?_.push(e.getTargetData()):r()}_.forEach((t=>o.set(e,t)))})),o}}exports.HspTargetUtils=HspTargetUtils,HspTargetUtils._log=ohos_logger_1.OhosLogger.getLogger("HspTargetUtils");