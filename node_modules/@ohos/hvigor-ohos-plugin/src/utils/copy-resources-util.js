"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.toUnixPath=exports.getCopyOptions=void 0;const fs_1=__importDefault(require("fs")),os_1=__importDefault(require("os")),path_1=__importDefault(require("path"));function getCopyOptions(e){var t,s,a;null!==(t=e.isPreview)&&void 0!==t||(e.isPreview=!1);const r=[],o="../share",i=e.aceModuleRoot,n=e.aceModuleBuild||path_1.default.resolve(i,"build");r.push({src:path_1.default.resolve(i,"**/*"),dest:n,ignore:["**/*.ets","**/*.ts","**/*.js"],onlyFiles:!0,rename:renameDestFile(i)});const u=path_1.default.resolve(i,o);fs_1.default.existsSync(u)&&r.push({src:path_1.default.resolve(u,"**/*"),dest:path_1.default.resolve(n,o),ignore:["**/*.ets","**/*.ts","**/*.js"],onlyFiles:!0,rename:renameDestFile(u)});"page"===(null!==(s=e.abilityType)&&void 0!==s?s:"page")&&e.aceManifestPath&&fs_1.default.existsSync(e.aceManifestPath)&&r.push({src:e.aceManifestPath,dest:n});const l=/ets_loader_ark$/.test(__dirname),p=null!==(a=e.cachePath)&&void 0!==a?a:path_1.default.resolve(__dirname,"node_modules/.cache");return e.appResource&&fs_1.default.existsSync(e.appResource)&&!l&&e.isPreview&&r.push({src:path_1.default.resolve(__dirname,e.appResource),dest:path_1.default.resolve(__dirname,p)}),{targets:formatCopyPatterns(r)}}function renameDestFile(e){return(t,s,a)=>{a=toUnixPath(a);const r=toUnixPath(e);if(-1!==a.indexOf(r)){let e=a.replace(r,"");return e.startsWith("/")&&(e=e.substring(1)),e}return`${t}.${s}`}}function formatCopyPatterns(e){return e.forEach((e=>{e.src=toUnixPath(e.src),e.dest=toUnixPath(e.dest)})),e}function toUnixPath(e){return"Windows_NT"===os_1.default.type()?path_1.default.posix.join(...e.split(path_1.default.sep)):e}exports.getCopyOptions=getCopyOptions,exports.toUnixPath=toUnixPath;