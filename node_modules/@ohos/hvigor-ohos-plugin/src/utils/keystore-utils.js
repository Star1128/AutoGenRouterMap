"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,l){void 0===l&&(l=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,l,o)}:function(e,t,r,l){void 0===l&&(l=r),e[l]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeyStoreHelper=void 0;const fse=__importStar(require("fs-extra")),path_1=__importDefault(require("path")),decipher_util_1=require("./decipher-util"),file_util_1=require("./file-util"),keytool_utils_1=require("./keytool-utils");class KeyStoreHelper{static getDefaultDebugKeyStoreLocation(){const e=process.env.HOME||process.env.USERPROFILE;if(void 0===e)return;const t=path_1.default.resolve(e,KeyStoreHelper.DEFAULT_IDE_CONFIG_PATH,KeyStoreHelper.CONFIG);return fse.existsSync(t)||fse.mkdirsSync(t),path_1.default.resolve(t,KeyStoreHelper.DEFAULT_DEBUG_SIGN_FILE)}static createDefaultDebugStore(){const e=KeyStoreHelper.getDefaultDebugKeyStoreLocation();void 0===e||fse.existsSync(e)||KeyStoreHelper.createDebugStore(e,KeyStoreHelper.DEFAULT_STORE_PASS,KeyStoreHelper.DEFAULT_ALIAS)||(file_util_1.FileUtil.deleteFile(KeyStoreHelper.requestCertFile),file_util_1.FileUtil.deleteFile(KeyStoreHelper.generateCertFile))}static createDebugStore(e,t,r){return KeyStoreHelper.createNewStore(e,t,r,KeyStoreHelper.CERTIFICATE_DESC)}static createNewStore(e,t,r,l){let o;const i=new keytool_utils_1.KeytoolUtils(e,t,r,l);return o=i.generateKeyPair(KeyStoreHelper.validity,KeyStoreHelper.keyBitsLength,KeyStoreHelper.keyAlgo,KeyStoreHelper.signatureAlgo,KeyStoreHelper.validFrom),o?(o=i.requestCert(KeyStoreHelper.requestCertFile),o?(o=i.generateCert(!0,KeyStoreHelper.validity,KeyStoreHelper.signatureAlgo,KeyStoreHelper.validFrom,KeyStoreHelper.requestCertFile,KeyStoreHelper.generateCertFile),o?(o=i.importCert(!0,KeyStoreHelper.generateCertFile),o):o):o):o}static loadDefaultStorePass(){return decipher_util_1.DecipherUtil.decryptPluginDataFromResource(KeyStoreHelper.DEFAULT_STORE_PASS_FILE)}}exports.KeyStoreHelper=KeyStoreHelper,KeyStoreHelper.CERTIFICATE_DESC="CN=debugkey",KeyStoreHelper.DEFAULT_IDE_CONFIG_PATH=".ohos",KeyStoreHelper.CONFIG="config",KeyStoreHelper.DEFAULT_DEBUG_SIGN_FILE="debug.p12",KeyStoreHelper.keyBitsLength=3072,KeyStoreHelper.DEFAULT_STORE_PASS_FILE="../../res/material/zb/de",KeyStoreHelper.DEFAULT_STORE_PASS=KeyStoreHelper.loadDefaultStorePass(),KeyStoreHelper.DEFAULT_ALIAS="debugKey",KeyStoreHelper.validity=365,KeyStoreHelper.validFrom=new Date,KeyStoreHelper.keyAlgo="RSA",KeyStoreHelper.signatureAlgo="SHA256withRSA",KeyStoreHelper.requestCertFile="requestCert.req",KeyStoreHelper.generateCertFile="generateCert.gen";