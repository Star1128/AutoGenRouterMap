"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.projectBuildProfileLoader=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),common_const_js_1=require("../../../const/common-const.js"),abstract_build_profile_loader_js_1=require("./abstract-build-profile-loader.js");class ProjectBuildProfileLoader extends abstract_build_profile_loader_js_1.AbstractBuildProfileLoader{constructor(){super(...arguments),this.logger=hvigor_1.HvigorLogger.getLogger(ProjectBuildProfileLoader.name)}getBuildProfile(){return this.getBuildProfileJson5Obj(hvigor_1.hvigor.getRootNode().getNodeName())}setBuildProfileJson5Obj(e,o,r=!0){super.setBuildProfileJson5ObjCheck(e,o,common_const_js_1.BuildProfileSchemaFileConst.PROJECT_BUILD_PROFILE_SCHEMA_PATH)}initializeReplace(e){return this.replaceTargets(e)}replaceTargets(e){const o=(0,wdk_1.cloneDeep)(e);return hvigor_1.hvigor.getRootNode().subNodes((e=>{o.modules.some((o=>o.name===e.getNodeName()))||o.modules.push({name:e.getNodeName(),srcPath:e.getNodePath()});const r=e.getExtraOption("targets");if(r){o.modules.forEach((o=>{o.name===e.getNodeName()&&(o.targets=r)}))}})),o}checkBuildProfile(e,o){if(!e.app.products||!o.app.products||e.app.products.length!==o.app.products.length)return void this.logger.errorMessageExit("Cannot add or delete products.");const r=e.app.products,t=o.app.products;r.forEach((e=>{const o=t.find((o=>o.name===e.name));o?o.runtimeOS!==e.runtimeOS&&this.logger.errorMessageExit(`Cannot change the runtimeOS of product '${e.name}'. Expected '${e.runtimeOS}', found '${o.runtimeOS}'.`):this.logger.errorMessageExit(`Cannot rename products. Keep the name  '${e.name}' unchanged.`)}))}}exports.projectBuildProfileLoader=new ProjectBuildProfileLoader;