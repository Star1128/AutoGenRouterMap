"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.resModelLoader=void 0;const fs_extra_1=__importDefault(require("fs-extra")),json_util_js_1=require("../../json-util.js"),ohos_logger_js_1=require("../../log/ohos-logger.js"),validate_util_js_1=require("../../validate/validate-util.js"),validator_store_js_1=require("../../validate/validator-store.js"),config_file_loader_js_1=require("../config-file-loader.js"),log=ohos_logger_js_1.OhosLogger.getLogger("ResModelLoader");class ResModelLoader{constructor(){this.appJsonSchemaPath=void 0,this.moduleJsonSchemaPath=void 0}getAppJson(e){return this.getResModelJsonObj(e,this.appJsonSchemaPath)}getModuleJson(e){return this.getResModelJsonObj(e,this.moduleJsonSchemaPath)}getConfigJson(e){return this.getResModelJsonObj(e,void 0)}setAppJson(e,o){void 0===this.appJsonSchemaPath&&log.errorMessageExit("app.json5 schemaPath not initialized"),this.setResModelJsonObj(e,o,this.appJsonSchemaPath)}setModuleJson(e,o){void 0===this.moduleJsonSchemaPath&&log.errorMessageExit("module.json5 schemaPath not initialized"),this.setResModelJsonObj(e,o,this.moduleJsonSchemaPath)}setConfigJson(e,o){this.setResModelJsonObj(e,o,void 0)}getResModelJsonObj(e,o){const s=config_file_loader_js_1.configFileLoader.getConfigFileJson(e);if(s)return s;if(null!==s){if(fs_extra_1.default.existsSync(e)){const s=(0,json_util_js_1.getJson5Obj)(e);return this.setResModelJsonObj(e,s,o),s}return log.debug(`not found resModel json file in : ${e}`),void this.setResModelJsonObj(e,null,void 0)}}setResModelJsonObj(e,o,s){s&&this.validateBuildProfile(o,s),config_file_loader_js_1.configFileLoader.setConfigFileJson(e,o)}validateBuildProfile(e,o){const s=validator_store_js_1.ValidatorStore.addValidator(o);try{validate_util_js_1.ValidateUtil.schemaCheckJSObject(e,void 0,s)}catch(e){e instanceof Error&&log.errorExit(e)}}initSchemaPath(e,o){this.appJsonSchemaPath=e,this.moduleJsonSchemaPath=o}clean(){this.appJsonSchemaPath=void 0,this.moduleJsonSchemaPath=void 0}}exports.resModelLoader=new ResModelLoader;