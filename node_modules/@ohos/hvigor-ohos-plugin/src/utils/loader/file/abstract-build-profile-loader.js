"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractBuildProfileLoader=void 0;const hvigor_1=require("@ohos/hvigor"),fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),common_const_js_1=require("../../../const/common-const.js"),json_util_js_1=require("../../json-util.js"),ohos_logger_js_1=require("../../log/ohos-logger.js"),validate_util_js_1=require("../../validate/validate-util.js"),validator_store_js_1=require("../../validate/validator-store.js"),config_file_loader_js_1=require("../config-file-loader.js"),log=ohos_logger_js_1.OhosLogger.getLogger("BuildProfileLoader");class AbstractBuildProfileLoader{getBuildProfileJson5Obj(e,o=!0){const i=hvigor_1.hvigor.getNodeByName(e);if(void 0===i)return void log.errorMessageExit(`node not found by node name: ${e}`);const t=path_1.default.resolve(i.getNodePath(),common_const_js_1.CommonConst.PROFILE_JSON5),r=config_file_loader_js_1.configFileLoader.getConfigFileJson(t);if(void 0!==r)return r;if(fs_extra_1.default.existsSync(t)){let i=(0,json_util_js_1.getJson5Obj)(t);return i=this.initializeReplace(i),this.setBuildProfileJson5Obj(e,i,o),i}log.warn(`not found build-profile json file in : ${t}`)}setBuildProfileJson5ObjCheck(e,o,i){const t=hvigor_1.hvigor.getNodeByName(e);if(void 0===t)return void log.errorMessageExit(`node not found by node name: ${e}`);const r=path_1.default.resolve(t.getNodePath(),common_const_js_1.CommonConst.PROFILE_JSON5);config_file_loader_js_1.configFileLoader.setConfigFileJson(r,o),i&&this.validateBuildProfile(o,r,i)}validateBuildProfile(e,o,i){const t=validator_store_js_1.ValidatorStore.addValidator(i);try{validate_util_js_1.ValidateUtil.schemaCheckJSObject(e,void 0,t)}catch(e){e instanceof Error&&log.errorExit(e)}}initializeReplace(e){return e}}exports.AbstractBuildProfileLoader=AbstractBuildProfileLoader;