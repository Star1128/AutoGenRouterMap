"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,i,e,s){void 0===s&&(s=e);var r=Object.getOwnPropertyDescriptor(i,e);r&&!("get"in r?!i.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return i[e]}}),Object.defineProperty(t,s,r)}:function(t,i,e,s){void 0===s&&(s=e),t[s]=i[e]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&__createBinding(i,t,e);return __setModuleDefault(i,t),i},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RestoolCommandBuilder=void 0;const hvigor_1=require("@ohos/hvigor"),fse=__importStar(require("fs-extra")),path_1=__importDefault(require("path")),build_directory_const_js_1=require("../const/build-directory-const.js"),file_util_js_1=require("../utils/file-util.js"),base_command_builder_js_1=require("./base-command-builder.js");class RestoolCommandBuilder extends base_command_builder_js_1.BaseCommandBuilder{constructor(t){super([]),this.inputFiles=new hvigor_1.FileSet,this.outputFiles=new hvigor_1.FileSet,this.existsResourceDir=!1,this.restoolLinkParamObj={appScopeResources:void 0,moduleResourcesMap:new Map,harResourcesMap:new Map,outputPath:void 0,linkCommand:[]},this.commandList.push(t),this.restoolLinkParamObj.linkCommand.push(t)}addInputVariantDir(t){return fse.existsSync(t)?(file_util_js_1.FileUtil.checkPathLength(t),this.commandList.push("-b"),this.commandList.push(t),this):this}addInputDir(t,i){return fse.existsSync(t)?(file_util_js_1.FileUtil.checkPathLength(t),this.existsResourceDir=!0,this.commandList.push("-i"),this.commandList.push(t),this):this}addEntryCompiledResource(t){return this}addAppScopeResourcesDir(t){return fse.existsSync(t)?(file_util_js_1.FileUtil.checkPathLength(t),this.inputFiles.addEntry(t),this.existsResourceDir=!0,this.restoolLinkParamObj.appScopeResources=t,this):this}addModuleResourcesMap(t){const i=new Map;return t.forEach(((t,e)=>{fse.existsSync(e)&&(file_util_js_1.FileUtil.checkPathLength(e),this.inputFiles.addEntry(e),i.set(e,t),this.existsResourceDir=!0)})),this.restoolLinkParamObj.moduleResourcesMap=i,this}addHarResourcesMap(t){const i=new Map;return t.forEach(((t,e)=>{if(!fse.existsSync(e))return;file_util_js_1.FileUtil.checkPathLength(e);fse.statSync(e).isDirectory()?this.inputFiles.addEntry(e):this.inputFiles.addEntry(e,{isDirectory:!1}),i.set(e,t),this.existsResourceDir=!0})),this.restoolLinkParamObj.harResourcesMap=i,this}addJsonFile(t){return file_util_js_1.FileUtil.checkPathLength(t),this.inputFiles.addEntry(t,{isDirectory:!1}),this.commandList.push("-j"),this.commandList.push(t),this.restoolLinkParamObj.linkCommand.push("-j"),this.restoolLinkParamObj.linkCommand.push(t),this}addModulePackName(t){return this.commandList.push("-p"),this.commandList.push(t),this.restoolLinkParamObj.linkCommand.push("-p"),this.restoolLinkParamObj.linkCommand.push(t),this}addOutputDir(t){return file_util_js_1.FileUtil.checkPathLength(t),this.outputFiles.addEntry(t),this.commandList.push("-o"),this.commandList.push(t),this.restoolLinkParamObj.outputPath=t,this}addIdsPath(t){return file_util_js_1.FileUtil.checkPathLength(t),this.restoolLinkParamObj.linkCommand.push("--ids"),this.restoolLinkParamObj.linkCommand.push(t),this.restoolLinkParamObj.idsMapPath=t,this}addResTable(t){return file_util_js_1.FileUtil.checkPathLength(t),this.commandList.includes(t)||(this.outputFiles.addEntry(t,{isDirectory:!1}),this.commandList.push("-r"),this.commandList.push(t),this.restoolLinkParamObj.linkCommand.push("-r"),this.restoolLinkParamObj.linkCommand.push(t)),this}forceDelete(){return this.commandList.push("-f"),this.restoolLinkParamObj.linkCommand.push("-f"),this}incremental(){return this.commandList.push("-c"),this}compressImage(){return this.commandList.push("-z"),this}addOutputBak(t){return file_util_js_1.FileUtil.checkPathLength(t),this.commandList.push("-n"),this.commandList.push(t),this}addModules(t){return this.commandList.push("-m"),this.commandList.push(t),this.restoolLinkParamObj.linkCommand.push("-m"),this.restoolLinkParamObj.linkCommand.push(t),this}addStartId(t){return this}setIconCheck(t){return this}incrementalCompile(){return this.restoolLinkParamObj.linkCommand.push("-z"),this}addDefinedIds(t){return file_util_js_1.FileUtil.checkPathLength(t),this.restoolLinkParamObj.linkCommand.push("--defined-ids"),this.restoolLinkParamObj.linkCommand.push(path_1.default.resolve(t,build_directory_const_js_1.BuildArtifactConst.ID_DEFINED_JSON)),this}addDefinedSysIds(t){return this}}exports.RestoolCommandBuilder=RestoolCommandBuilder;