"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateNativeLibrary=void 0;const path_1=__importDefault(require("path")),native_library_model_js_1=require("./native-library-model.js");class GenerateNativeLibrary{static parseLibrary(t,e,i){var r,s;const a=new native_library_model_js_1.NativeLibraryModel(e.name,e.id,e.type);return a.setAbi(t),a.setBuildType(i),a.setFolders(this.findFolders(e)),a.setFiles(this.findFiles(e)),a.setOutputs(this.findOutputs(e)),a.setNameOnDisk(e.nameOnDisk),a.setRuntimeFiles(this.findRuntimeFiles(e)),a.setBuild(null===(r=e.paths)||void 0===r?void 0:r.build),a.setSource(null===(s=e.paths)||void 0===s?void 0:s.source),a}static findFolders(t){var e;const i=[];return null===(e=t.compileGroups)||void 0===e||e.forEach((t=>{var e;null===(e=t.includes)||void 0===e||e.forEach((t=>{t.path&&i.push(t.path)}))})),i}static findFiles(t){var e;const i=[];return null===(e=t.sources)||void 0===e||e.forEach((e=>{var r;const s=null!==(r=t.sourceGroups)&&void 0!==r?r:[],a=void 0===e.sourceGroupIndex?void 0:s[e.sourceGroupIndex];a&&"Source Files"!==a.name&&e.path&&i.push(e.path)})),i}static findOutputs(t){var e;const i=[];return null===(e=t.artifacts)||void 0===e||e.forEach((t=>{t.path&&i.push(t.path)})),i}static findRuntimeFiles(t){var e,i,r,s;const a=[];let o=null===(i=null===(e=t.link)||void 0===e?void 0:e.sysroot)||void 0===i?void 0:i.path;return o&&(o=path_1.default.resolve(o)),null===(s=null===(r=t.link)||void 0===r?void 0:r.commandFragments)||void 0===s||s.forEach((e=>{var i,r;if("libraries"!==e.role)return;let s=e.fragment;s&&(s.startsWith("-")||s.endsWith(".a")||(!path_1.default.isAbsolute(s)&&(null===(i=t.paths)||void 0===i?void 0:i.build)&&(s=path_1.default.join(null===(r=t.paths)||void 0===r?void 0:r.build,s)),o&&s.startsWith(o)||a.push(s)))})),a}}exports.GenerateNativeLibrary=GenerateNativeLibrary;