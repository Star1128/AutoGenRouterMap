"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OhosProjectContextImpl=void 0;const core_project_profile_js_1=require("../../../common/global/core-project-profile.js"),wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),path_1=__importDefault(require("path")),core_product_js_1=require("../../../common/global/core-product.js"),build_directory_const_js_1=require("../../../const/build-directory-const.js"),common_const_js_1=require("../../../const/common-const.js"),build_mode_manager_js_1=require("../../../project/build-option/build-mode-manager.js"),oh_package_loader_1=require("../../../utils/loader/file/oh-package-loader"),project_build_profile_loader_js_1=require("../../../utils/loader/file/project-build-profile-loader.js"),res_model_loader_js_1=require("../../../utils/loader/file/res-model-loader.js");class OhosProjectContextImpl{constructor(e,t){this.logger=hvigor_1.HvigorLogger.getLogger(OhosProjectContextImpl.name),this.projectPlugin=e,this.projectPath=this.projectPlugin.getProjectModel().getProject().getNodeDir(),this.taskService=t,this.projectOhPackagePath=path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.OH_PACKAGE_JSON5),res_model_loader_js_1.resModelLoader.initSchemaPath(this.taskService.getSdkInfo().getAppSchema(),this.taskService.getSdkInfo().getModuleSchema()),this.initCurrentProduct(),this.initBuildPath()}getOhpmDependencyInfo(){return this.taskService.getOhpmDependencyInfo()}getProjectName(){return this.projectPlugin._project.getName()}getBuildMode(){return build_mode_manager_js_1.BuildModeManager.getBuildMode()}getProjectPath(){return this.projectPlugin._project.getNodeDir()}getCurrentProduct(){return this.currentProduct}initCurrentProduct(){const e=core_project_profile_js_1.CoreProjectProfile.getInstance(this.projectPath).getCurrentProductOpt();this.currentProduct=new core_product_js_1.CoreProduct(e,this.taskService.getProjectModel())}initBuildPath(){this.buildRootPath=this.taskService.getPathInfo().getProjectBuildPath(),this.buildProductOutputPath=path_1.default.resolve(this.buildRootPath,build_directory_const_js_1.BuildDirConst.BUILD_OUTPUTS,this.currentProduct.getProductName())}getBuildProductOutputPath(){return this.buildProductOutputPath}getBuildRootPath(){return this.buildRootPath}getAppJsonOpt(){return(0,wdk_1.cloneDeep)(res_model_loader_js_1.resModelLoader.getAppJson(path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.APP_SCOPE,common_const_js_1.CommonConst.APP_CONFIG)))}getBuildProfileOpt(){return(0,wdk_1.cloneDeep)(project_build_profile_loader_js_1.projectBuildProfileLoader.getBuildProfile())}setAppJsonOpt(e){this.taskService.isFaMode()&&this.logger.errorMessageExit("FA mode does not support modifying the app.json5."),res_model_loader_js_1.resModelLoader.setAppJson(path_1.default.resolve(this.projectPath,common_const_js_1.CommonConst.APP_SCOPE,common_const_js_1.CommonConst.APP_CONFIG),e)}setBuildProfileOpt(e){var t;this.taskService.isFaMode()&&this.logger.errorMessageExit("FA mode does not support modifying the buildProfile."),project_build_profile_loader_js_1.projectBuildProfileLoader.checkBuildProfile(project_build_profile_loader_js_1.projectBuildProfileLoader.getBuildProfile(),e),project_build_profile_loader_js_1.projectBuildProfileLoader.setBuildProfileJson5Obj(this.getProjectName(),e),null===(t=this.projectPlugin.getProjectModel())||void 0===t||t.refreshData(),this.projectPlugin.initBuildOptionMap(),this.taskService.refreshData()}getDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDependenciesOpt(this.projectOhPackagePath))}getDevDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDevDependenciesOpt(this.projectOhPackagePath))}getDynamicDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDynamicDependenciesOpt(this.projectOhPackagePath))}setDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDependenciesOpt(this.projectOhPackagePath,e)}setDevDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDevDependenciesOpt(this.projectOhPackagePath,e)}setDynamicDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDynamicDependenciesOpt(this.projectOhPackagePath,e)}}exports.OhosProjectContextImpl=OhosProjectContextImpl;