"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OhosModuleContextImpl=void 0;const wdk_1=require("@baize/wdk"),hvigor_1=require("@ohos/hvigor"),path_1=__importDefault(require("path")),common_const_js_1=require("../../../const/common-const.js"),inject_util_js_1=require("../../../utils/inject-util.js"),har_module_build_profile_loader_js_1=require("../../../utils/loader/file/har-module-build-profile-loader.js"),module_build_profile_loader_js_1=require("../../../utils/loader/file/module-build-profile-loader.js"),oh_package_loader_1=require("../../../utils/loader/file/oh-package-loader"),res_model_loader_js_1=require("../../../utils/loader/file/res-model-loader.js");class OhosModuleContextImpl{constructor(e){var o;this.logger=hvigor_1.HvigorLogger.getLogger(OhosModuleContextImpl.name),this.modulePlugin=e,this.taskService=this.modulePlugin.getTaskService(),this.targetArr=this.taskService.getTargets(),this.moduleOhPackagePath=null===(o=this.modulePlugin.getModuleModel())||void 0===o?void 0:o.getOhPackageJson5Path()}targets(e){this.targetArr.forEach((o=>e(o)))}getModuleName(){return this.modulePlugin.getModuleModel().getModule().getName()}getModulePath(){return this.modulePlugin.getModuleModel().getModule().getNodeDir()}getModuleType(){return this.modulePlugin.getModuleModel().getModuleType()}getBuildProductRootPath(){return path_1.default.resolve(inject_util_js_1.InjectUtil.getModuleBuildRootPath(this.getModulePath()),this.getModulePath())}getOhpmDependencyInfo(){return this.taskService.getOhpmDependencyInfo()}getBuildProfileOpt(){return(0,wdk_1.cloneDeep)(this.taskService.getModuleModel().isHarModule()?har_module_build_profile_loader_js_1.harModuleBuildProfileLoader.getBuildProfile(this.getModuleName()):module_build_profile_loader_js_1.moduleBuildProfileLoader.getBuildProfile(this.getModuleName()))}getModuleJsonOpt(){const e=path_1.default.resolve(this.taskService.getProjectModel().getProjectDir(),this.getModulePath(),`src/main/${common_const_js_1.CommonConst.MODULE_JSON5}`);return(0,wdk_1.cloneDeep)(res_model_loader_js_1.resModelLoader.getModuleJson(e))}setBuildProfileOpt(e){var o;this.taskService.isFaMode()&&this.logger.errorMessageExit("FA mode does not support modifying the buildProfile."),this.taskService.getModuleModel().isHarModule()?har_module_build_profile_loader_js_1.harModuleBuildProfileLoader.setBuildProfileJson5Obj(this.getModuleName(),e):module_build_profile_loader_js_1.moduleBuildProfileLoader.setBuildProfileJson5Obj(this.getModuleName(),e),null===(o=this.modulePlugin.getModuleModel())||void 0===o||o.refreshData(),this.modulePlugin.initBuildOptionMap(),this.modulePlugin.refreshTargetServiceList()}setModuleJsonOpt(e){this.taskService.isFaMode()&&this.logger.errorMessageExit("FA mode does not support modifying the module.json5.");const o=path_1.default.resolve(this.taskService.getProjectModel().getProjectDir(),this.getModulePath(),`src/main/${common_const_js_1.CommonConst.MODULE_JSON5}`);res_model_loader_js_1.resModelLoader.setModuleJson(o,e)}getDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDependenciesOpt(this.moduleOhPackagePath))}getDevDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDevDependenciesOpt(this.moduleOhPackagePath))}getDynamicDependenciesOpt(){return(0,wdk_1.cloneDeep)(oh_package_loader_1.ohPackageLoader.getDynamicDependenciesOpt(this.moduleOhPackagePath))}setDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDependenciesOpt(this.moduleOhPackagePath,e)}setDevDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDevDependenciesOpt(this.moduleOhPackagePath,e)}setDynamicDependenciesOpt(e){oh_package_loader_1.ohPackageLoader.setDynamicDependenciesOpt(this.moduleOhPackagePath,e)}getVersion(){return oh_package_loader_1.ohPackageLoader.getVersion(this.moduleOhPackagePath)}setVersion(e){oh_package_loader_1.ohPackageLoader.setVersion(this.moduleOhPackagePath,e)}}exports.OhosModuleContextImpl=OhosModuleContextImpl;