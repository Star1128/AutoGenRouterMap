"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateReadStruct=void 0;const pack_1=require("./pack"),unpack_1=require("./unpack"),DATE=16,TYPE_NAMES=["num","object","string","ascii"];let textEncoder,currentSource;TYPE_NAMES[16]="date";try{textEncoder=new TextEncoder}catch(t){}function createTypeTransition(t,e,n){const r=TYPE_NAMES[e]+(n<<3),c=t[r]||(t[r]=Object.create(null));return c.__type=e,c.__size=n,c.__parent=t,c}const transitionOption={enumerationOffset:0,ascii0:null,ascii8:null,num8:null,string16:null,object16:null,num32:null,float64:null,date64:null};function onLoadedStructures(t){if(!(t instanceof Map))return t;let e=t.get("typed")||[];Object.isFrozen(e)&&(e=e.map((t=>t.slice(0))));const n=t.get("named"),r=Object.create(null);for(let t=0,n=e.length;t<n;t++){const n=e[t];let c=r;for(const[t,e,r]of n){let n=c[r];n||(c[r]=n={key:r,parent:c,...transitionOption}),c=createTypeTransition(n,t,e)}c[pack_1.RECORD_SYMBOL]=t}return e.transitions=r,n}function saveState(){currentSource&&(currentSource.bytes=Uint8Array.prototype.slice.call(currentSource.bytes,currentSource.position,currentSource.bytesEnd),currentSource.position=0,currentSource.bytesEnd=currentSource.bytes.length)}function updateReadStruct(){(0,unpack_1.setReadStruct)(onLoadedStructures,saveState)}exports.updateReadStruct=updateReadStruct;