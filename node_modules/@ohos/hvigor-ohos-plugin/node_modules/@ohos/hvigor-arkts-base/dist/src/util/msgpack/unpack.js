"use strict";let decoder,src,srcEnd;Object.defineProperty(exports,"__esModule",{value:!0}),exports.resetUnpack=exports.FLOAT32_OPTIONS=exports.addExtension=exports.setReadStruct=exports.clearSource=exports.mult10=exports.typedArrays=exports.loadStructures=exports.read=exports.readGEc0=exports.readLTc0=exports.readLTa0=exports.checkedRead=exports.Unpackr=exports.C1=exports.C1Type=void 0;try{decoder=new TextDecoder}catch(r){}let position=0;const EMPTY_ARRAY=[];let currentStructures,srcString,bundledStrings,referenceMap,strings=EMPTY_ARRAY,stringPosition=0,currentUnpackr={},srcStringStart=0,srcStringEnd=0;const currentExtensions=[];let dataView;const defaultOptions={useRecords:!1,mapsAsObjects:!0};class C1Type{}exports.C1Type=C1Type,exports.C1=new C1Type,exports.C1.name="MessagePack 0xC1";const inlineObjectReadThreshold=2;let onLoadedStructures,onSaveState;class Unpackr{unpack(r){if(src)throw new Error("Re-entrant unpack execution");r.buffer||r.constructor!==ArrayBuffer||(r="undefined"!=typeof Buffer?Buffer.from(r):new Uint8Array(r)),position=0,srcEnd=r.length,srcString=null,stringPosition=0,srcStringEnd=0,strings=EMPTY_ARRAY,bundledStrings=null,src=r;try{dataView=r.dataView||(r.dataView=new DataView(r.buffer,r.byteOffset,r.byteLength))}catch(t){if(src=null,r instanceof Uint8Array)throw t;throw new Error(`Source must be a Uint8Array or Buffer but was a ${r&&"object"==typeof r?r.constructor.name:typeof r}`)}if(this instanceof Unpackr){if(currentUnpackr=this,this.structures)return currentStructures=this.structures,checkedRead()}else currentUnpackr=defaultOptions;return(!currentStructures||currentStructures.length>0)&&(currentStructures=[]),checkedRead()}_mergeStructures(r,t){onLoadedStructures&&(r=onLoadedStructures.call(this,r)),r=r||[],Object.isFrozen(r)&&(r=r.map((r=>r.slice(0))));for(let t=0,e=r.length;t<e;t++){const e=r[t];e&&(e.isShared=!0,t>=32&&(e.highByte=t-32>>5))}r.sharedLength=r.length;for(const e in t||[]){if(e<0)continue;const n=r[e],o=t[e];o&&(n&&((r.restoreStructures||(r.restoreStructures=[]))[e]=n),r[e]=o)}return this.structures=r}}function checkedRead(){try{const r=currentStructures.sharedLength||0;r<currentStructures.length&&(currentStructures.length=r);const t=read();if(bundledStrings&&(position=bundledStrings.postBundlePosition,bundledStrings=null),position!==srcEnd){if(position>srcEnd)throw new Error("Unexpected end of MessagePack data");{let r;try{r=JSON.stringify(t,((r,t)=>"bigint"==typeof t?`${t}n`:t)).slice(0,100)}catch(t){r=`(JSON view not available ${t})`}throw new Error(`Data read, but end of buffer not reached ${r}`)}}return currentStructures&&currentStructures.restoreStructures&&restoreStructures(),src=null,currentStructures=null,referenceMap&&(referenceMap=null),t}catch(r){throw currentStructures&&currentStructures.restoreStructures&&restoreStructures(),clearSource(),(r instanceof RangeError||r.message.startsWith("Unexpected end of buffer")||position>srcEnd)&&(r.incomplete=!0),r}}function restoreStructures(){for(const r in currentStructures.restoreStructures)currentStructures[r]=currentStructures.restoreStructures[r];currentStructures.restoreStructures=null}exports.Unpackr=Unpackr,exports.checkedRead=checkedRead;const readFixedString=readStringJS,readString8=readStringJS,readString16=readStringJS,readString32=readStringJS;function readLTa0(r){if(r<128){if(r<64)return r;{const t=currentStructures[63&r];return t?(t.read||(t.read=createStructureReader(t,63&r)),t.read()):r}}if(r<144){r-=128;const t=new Map;for(let e=0;e<r;e++)t.set(read(),read());return t}{r-=144;const t=new Array(r);for(let e=0;e<r;e++)t[e]=read();return t}}function readLTc0(r){const t=r-160;if(srcStringEnd>=position)return srcString.slice(position-srcStringStart,(position+=t)-srcStringStart);if(0===srcStringEnd&&srcEnd<140){const r=t<16?shortStringInJS(t):longStringInJS(t);if(null!=r)return r}return readFixedString(t)}function readc0(){return null}function readc1(){if(bundledStrings){const r=read();return r>0?bundledStrings[1].slice(bundledStrings.position1,bundledStrings.position1+=r):bundledStrings[0].slice(bundledStrings.position0,bundledStrings.position0-=r)}return exports.C1}function readc2(){return!1}function readc3(){return!0}function readc4(){const r=src[position++];if(void 0===r)throw new Error("Unexpected end of buffer");return readBin(r)}function readc5(){const r=dataView.getUint16(position);return position+=2,readBin(r)}function readc6(){const r=dataView.getUint32(position);return position+=4,readBin(r)}function readc7(){return readExt(src[position++])}function readc8(){const r=dataView.getUint16(position);return position+=2,readExt(r)}function readc9(){const r=dataView.getUint32(position);return position+=4,readExt(r)}function readca(){const r=dataView.getFloat32(position);return position+=4,r}function readcb(){const r=dataView.getFloat64(position);return position+=8,r}function readcc(){return src[position++]}function readcd(){const r=dataView.getUint16(position);return position+=2,r}function readce(){const r=dataView.getUint32(position);return position+=4,r}function readcf(){let r;return"number"===currentUnpackr.int64AsType?(r=4294967296*dataView.getUint32(position),r+=dataView.getUint32(position+4)):"string"===currentUnpackr.int64AsType?r=dataView.getBigUint64(position).toString():"auto"===currentUnpackr.int64AsType?(r=dataView.getBigUint64(position),r<=BigInt(2)<<BigInt(52)&&(r=Number(r))):r=dataView.getBigUint64(position),position+=8,r}function readd0(){return dataView.getInt8(position++)}function readd1(){const r=dataView.getInt16(position);return position+=2,r}function readd2(){const r=dataView.getInt32(position);return position+=4,r}function readd3(){const r=dataView.getBigInt64(position);return position+=8,r}function readd4(){const r=src[position++];if(114===r)return recordDefinition(63&src[position++]);{const t=currentExtensions[r];if(t)return t.read?(position++,t.read(read())):t.noBuffer?(position++,t()):t(src.subarray(position,++position));throw new Error(`Unknown extension ${r}`)}}function readd5(){return 114===src[position]?(position++,recordDefinition(63&src[position++],src[position++])):readExt(2)}function readd6(){return readExt(4)}function readd7(){return readExt(8)}function readd8(){return readExt(16)}function readd9(){const r=src[position++];return srcStringEnd>=position?srcString.slice(position-srcStringStart,(position+=r)-srcStringStart):readString8(r)}function readda(){const r=dataView.getUint16(position);return position+=2,srcStringEnd>=position?srcString.slice(position-srcStringStart,(position+=r)-srcStringStart):readString16(r)}function readdb(){const r=dataView.getUint32(position);return position+=4,srcStringEnd>=position?srcString.slice(position-srcStringStart,(position+=r)-srcStringStart):readString32(r)}function readdc(){const r=dataView.getUint16(position);return position+=2,readArray(r)}function readdd(){const r=dataView.getUint32(position);return position+=4,readArray(r)}function readde(){const r=dataView.getUint16(position);return position+=2,readMap(r)}function readdf(){const r=dataView.getUint32(position);return position+=4,readMap(r)}function readDefault(r){if(r>=224)return r-256;if(void 0===r){const r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error(`Unknown MessagePack token ${r}`)}exports.readLTa0=readLTa0,exports.readLTc0=readLTc0;const readGEc0Map=new Map([[192,readc0],[193,readc1],[194,readc2],[195,readc3],[196,readc4],[197,readc5],[198,readc6],[199,readc7],[200,readc8],[201,readc9],[202,readca],[203,readcb],[204,readcc],[205,readcd],[206,readce],[207,readcf],[208,readd0],[209,readd1],[210,readd2],[211,readd3],[212,readd4],[213,readd5],[214,readd6],[215,readd7],[216,readd8],[217,readd9],[218,readda],[219,readdb],[220,readdc],[221,readdd],[222,readde],[223,readdf]]);function readGEc0(r){const t=readGEc0Map.get(r);return t?t():readDefault(r)}function read(){const r=src[position++];return r<160?readLTa0(r):r<192?readLTc0(r):readGEc0(r)}exports.readGEc0=readGEc0,exports.read=read;const validName=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function createStructureReader(r,t){function e(){if(e.count++>inlineObjectReadThreshold){const e=r.read=getStructureRead(r);return 0===r.highByte&&(r.read=createSecondByteReader(t,r.read)),e()}const n={};for(let t=0,e=r.length;t<e;t++){let e=r[t];"__proto__"===e&&(e="__proto_"),n[e]=read()}return n}return e.count=0,0===r.highByte?createSecondByteReader(t,e):e}function getStructureRead(r){return function(){const t={};return r.map((r=>{putValue(t,r)})),t}}function putValue(r,t){"__proto__"===t?r.__proto_=read():validName.test(t)?r[t]=read():r[`[${JSON.stringify(t)}]`]=read()}const createSecondByteReader=(r,t)=>function(){const e=src[position++];if(0===e)return t();const n=r<32?-(r+(e<<5)):r+(e<<5),o=currentStructures[n]||loadStructures()[n];if(!o)throw new Error(`Record id is not defined for ${n}`);return o.read||(o.read=createStructureReader(o,r)),o.read()};function loadStructures(){const r=saveState((()=>(src=null,currentUnpackr?.getStructures())));return currentStructures=currentUnpackr._mergeStructures(r,currentStructures)}exports.loadStructures=loadStructures;const fromCharCode=String.fromCharCode;function readStringJS(r){let t;if(r<16&&(t=shortStringInJS(r),t))return t;if(r>64&&decoder)return decoder.decode(src.subarray(position,position+=r));const e=position+r,n=[];for(t="";position<e;){const r=src[position++];if(128&r)if(192==(224&r)){const t=63&src[position++];n.push((31&r)<<6|t)}else if(224==(240&r)){const t=63&src[position++],e=63&src[position++];n.push((31&r)<<12|t<<6|e)}else if(240==(248&r)){let t=(7&r)<<18|(63&src[position++])<<12|(63&src[position++])<<6|63&src[position++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(r);else n.push(r);n.length>=4096&&(t+=fromCharCode.apply(String,n),n.length=0)}return n.length>0&&(t+=fromCharCode.apply(String,n)),t}function readArray(r){const t=new Array(r);for(let e=0;e<r;e++)t[e]=read();return t}function readMap(r){const t=new Map;for(let e=0;e<r;e++)t.set(read(),read());return t}function longStringInJS(r){const t=position,e=new Array(r);for(let n=0;n<r;n++){const r=src[position++];if((128&r)>0)return void(position=t);e[n]=r}return fromCharCode.apply(String,e)}function shortStringInJSLT4(r){if(r<2){if(0===r)return"";{const r=src[position++];return(128&r)>1?void(position-=1):fromCharCode(r)}}{const t=src[position++],e=src[position++];if((128&t)>0||(128&e)>0)return void(position-=2);if(r<3)return fromCharCode(t,e);const n=src[position++];return(128&n)>0?void(position-=3):fromCharCode(t,e,n)}}function shortStringInJSLT6(r,t,e,n,o){if(4===r)return fromCharCode(t,e,n,o);{const r=src[position++];return(128&r)>0?void(position-=5):fromCharCode(t,e,n,o,r)}}function shortStringInJSLT8(r,t,e,n,o){const i=src[position++],s=src[position++];if((128&i)>0||(128&s)>0)return void(position-=6);if(r<7)return fromCharCode(t,e,n,o,i,s);const c=src[position++];if(!((128&c)>0))return fromCharCode(t,e,n,o,i,s,c);position-=7}function shortStringInJSLT10(r,t,e,n,o,i,s,c,a){if(8===r)return fromCharCode(t,e,n,o,i,s,c,a);{const r=src[position++];return(128&r)>0?void(position-=9):fromCharCode(t,e,n,o,i,s,c,a,r)}}function shortStringInJSLT12(r,t,e,n,o,i,s,c,a){const u=src[position++],d=src[position++];if((128&u)>0||(128&d)>0)return void(position-=10);if(r<11)return fromCharCode(t,e,n,o,i,s,c,a,u,d);const p=src[position++];if(!((128&p)>0))return fromCharCode(t,e,n,o,i,s,c,a,u,d,p);position-=11}function shortStringInJSGE12(r,t,e,n,o,i,s,c,a){const u=src[position++],d=src[position++],p=src[position++],f=src[position++];if(!((128&u)>0||(128&d)>0||(128&p)>0||(128&f)>0)){if(r<14){if(12===r)return fromCharCode(t,e,n,o,i,s,c,a,u,d,p,f);{const r=src[position++];return(128&r)>0?void(position-=13):fromCharCode(t,e,n,o,i,s,c,a,u,d,p,f,r)}}{const S=src[position++],g=src[position++];if((128&S)>0||(128&g)>0)return void(position-=14);if(r<15)return fromCharCode(t,e,n,o,i,s,c,a,u,d,p,f,S,g);const l=src[position++];return(128&l)>0?void(position-=15):fromCharCode(t,e,n,o,i,s,c,a,u,d,p,f,S,g,l)}}position-=12}function shortStringInJSGE8(r,t,e,n,o){const i=src[position++],s=src[position++],c=src[position++],a=src[position++];if(!((128&i)>0||(128&s)>0||(128&c)>0||(128&a)>0))return r<10?shortStringInJSLT10(r,t,e,n,o,i,s,c,a):r<12?shortStringInJSLT12(r,t,e,n,o,i,s,c,a):shortStringInJSGE12(r,t,e,n,o,i,s,c,a);position-=8}function shortStringInJSGE4(r){const t=src[position++],e=src[position++],n=src[position++],o=src[position++];if(!((128&t)>0||(128&e)>0||(128&n)>0||(128&o)>0))return r<6?shortStringInJSLT6(r,t,e,n,o):r<8?shortStringInJSLT8(r,t,e,n,o):shortStringInJSGE8(r,t,e,n,o);position-=4}function shortStringInJS(r){return r<4?shortStringInJSLT4(r):shortStringInJSGE4(r)}function readOnlyJSString(){const r=src[position++];let t;if(r<192)t=r-160;else switch(r){case 217:t=src[position++];break;case 218:t=dataView.getUint16(position),position+=2;break;case 219:t=dataView.getUint32(position),position+=4;break;default:throw new Error("Expected string")}return readStringJS(t)}function readBin(r){return src.subarray(position,position+=r)}function readExt(r){const t=src[position++];if(currentExtensions[t]){let e;return currentExtensions[t](src.subarray(position,e=position+=r),(r=>{position=r;try{return read()}finally{position=e}}))}throw new Error(`Unknown extension type ${t}`)}const recordDefinition=(r,t)=>{const e=read().map((r=>r.toString())),n=r;void 0!==t&&(r=r<32?-((t<<5)+r):(t<<5)+r,e.highByte=t);const o=currentStructures[r];return o&&o.isShared&&((currentStructures.restoreStructures||(currentStructures.restoreStructures=[]))[r]=o),currentStructures[r]=e,e.read=createStructureReader(e,n),e.read()};currentExtensions[0]=()=>{},currentExtensions[0].noBuffer=!0;const errors={Error:Error,TypeError:TypeError,ReferenceError:ReferenceError};currentExtensions[101]=()=>{const r=read();return(errors[r[0]]||Error)(r[1])},currentExtensions[105]=()=>{const r=dataView.getUint32(position-4);referenceMap||(referenceMap=new Map);const t=src[position];let e;e=t>=144&&t<160||220===t||221===t?[]:{};const n={target:e};referenceMap.set(r,n);const o=read();return n.used?Object.assign(e,o):(n.target=o,o)},currentExtensions[112]=()=>{const r=dataView.getUint32(position-4),t=referenceMap.get(r);return t.used=!0,t.target},currentExtensions[115]=()=>new Set(read()),exports.typedArrays=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((r=>`${r}Array`));const glbl=globalThis;currentExtensions[116]=r=>{const t=r[0],e=exports.typedArrays[t];if(!e)throw new Error(`Could not find typed array for code ${t}`);return new glbl[e](Uint8Array.prototype.slice.call(r,1).buffer)},currentExtensions[120]=()=>{const r=read();return new RegExp(r[0],r[1])};const TEMP_BUNDLE=[];function saveState(r){onSaveState&&onSaveState();const t=srcEnd,e=position,n=stringPosition,o=srcStringStart,i=srcStringEnd,s=srcString,c=strings,a=referenceMap,u=bundledStrings,d=new Uint8Array(src.slice(0,srcEnd)),p=currentStructures,f=currentStructures.slice(0,currentStructures.length),S=currentUnpackr,g=r();return srcEnd=t,position=e,stringPosition=n,srcStringStart=o,srcStringEnd=i,bundledStrings=u,srcString=s,strings=c,referenceMap=a,src=d,dataView=new DataView(src.buffer,src.byteOffset,src.byteLength),currentStructures=p,currentStructures.splice(0,currentStructures.length,...f),currentUnpackr=S,g}currentExtensions[98]=r=>{const t=(r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3],e=position;return position+=t-r.length,bundledStrings=TEMP_BUNDLE,bundledStrings=[readOnlyJSString(),readOnlyJSString()],bundledStrings.postBundlePosition=position,bundledStrings.position0=0,bundledStrings.position1=0,position=e,read()},currentExtensions[255]=r=>4===r.length?new Date(1e3*(16777216*r[0]+(r[1]<<16)+(r[2]<<8)+r[3])):8===r.length?new Date(((r[0]<<22)+(r[1]<<14)+(r[2]<<6)+(r[3]>>2))/1e6+1e3*(4294967296*(3&r[3])+16777216*r[4]+(r[5]<<16)+(r[6]<<8)+r[7])):12===r.length?new Date(((r[0]<<24)+(r[1]<<16)+(r[2]<<8)+r[3])/1e6+1e3*((128&r[4]?-281474976710656:0)+1099511627776*r[6]+4294967296*r[7]+16777216*r[8]+(r[9]<<16)+(r[10]<<8)+r[11])):new Date("invalid"),exports.mult10=new Array(147);for(let r=0;r<256;r++)exports.mult10[r]=+`1e${Math.floor(45.15-.30103*r)}`;function clearSource(){src=null,referenceMap=null,currentStructures=null}function setReadStruct(r,t){onLoadedStructures=r,onSaveState=t}function addExtension(r){r.unpack?currentExtensions[r.type]=r.unpack:currentExtensions[r.type]=r}function resetUnpack(){dataView=void 0}exports.clearSource=clearSource,exports.setReadStruct=setReadStruct,exports.addExtension=addExtension,exports.FLOAT32_OPTIONS={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},exports.resetUnpack=resetUnpack;