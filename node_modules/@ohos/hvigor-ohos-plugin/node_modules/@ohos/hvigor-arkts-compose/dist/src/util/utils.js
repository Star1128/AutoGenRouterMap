"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOhPackageJsonPath=exports.getPkgName2SourceRootsMap=exports.getJson5Obj=exports.isVirtualFile=exports.isLinux=exports.toUnixPath=exports.writeFileSync=exports.readFile=exports.generateReport=exports.composeOhPackagePathMap=void 0;const generateReportForHvigorw_js_1=require("@ohos/coverage/lib/src/generateReportForHvigorw.js"),hvigor_arkts_base_1=require("@ohos/hvigor-arkts-base"),fs_1=__importDefault(require("fs")),json5_1=__importDefault(require("json5")),os_1=__importDefault(require("os")),path_1=__importDefault(require("path")),constants_js_1=require("./constants.js"),WINDOWS_OS_NAME="Windows_NT",LINUX_OS_NAME="Linux",logger=hvigor_arkts_base_1.ArktsBaseLogger.getLogger("ets-loader");async function generateReport(e,t,r){try{await(0,generateReportForHvigorw_js_1.generateReportForHvigorw)(e,t,r)}catch(e){logger.error(`GenerateReport ERROR: ${e}`)}}function readFile(e,t){try{fs_1.default.readdirSync(e).forEach((r=>{const o=path_1.default.join(e,r);fs_1.default.statSync(o).isDirectory()?readFile(o,t):t.push(o)}))}catch(e){logger.error(`ETS ERROR: ${e}`)}}function writeFileSync(e,t){if(!fs_1.default.existsSync(e)){const t=path_1.default.join(e,"..");fs_1.default.existsSync(t)&&!fs_1.default.statSync(t).isFile()||mkDir(t)}fs_1.default.writeFileSync(e,t)}function mkDir(e){const t=path_1.default.join(e,"..");fs_1.default.existsSync(t)&&!fs_1.default.statSync(t).isFile()||mkDir(t),fs_1.default.mkdirSync(e)}function toUnixPath(e){return isWindows()?path_1.default.posix.join(...e.split(path_1.default.sep)):e}function isWindows(){return os_1.default.type()===WINDOWS_OS_NAME}function isLinux(){return"Linux"===os_1.default.type()}function isVirtualFile(e){return e.startsWith(constants_js_1.VIRTUAL_FILE_PREFIX)}function getJson5Obj(e,t="utf-8"){if(!fs_1.default.existsSync(e))return;const r=fs_1.default.readFileSync(e,{encoding:t});try{return json5_1.default.parse(r)}catch(e){return}}function getPkgName2SourceRootsMap(e){const t={},r=e.pkgNameToPkgBriefInfo;return r?(Object.values(r).forEach((e=>{e.originalSourceRoots&&(t[e.pkgName]=e.originalSourceRoots)})),t):t}function getOhPackageJsonPath(e){return exports.composeOhPackagePathMap?.get(e)||e}exports.composeOhPackagePathMap=new Map,exports.generateReport=generateReport,exports.readFile=readFile,exports.writeFileSync=writeFileSync,exports.toUnixPath=toUnixPath,exports.isLinux=isLinux,exports.isVirtualFile=isVirtualFile,exports.getJson5Obj=getJson5Obj,exports.getPkgName2SourceRootsMap=getPkgName2SourceRootsMap,exports.getOhPackageJsonPath=getOhPackageJsonPath;