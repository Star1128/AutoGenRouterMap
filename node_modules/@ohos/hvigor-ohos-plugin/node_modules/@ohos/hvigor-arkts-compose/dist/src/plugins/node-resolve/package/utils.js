"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.InvalidPackageTargetError=exports.InvalidModuleSpecifierError=exports.InvalidConfigurationError=exports.ResolveError=exports.createErrorMsg=exports.createBaseErrorMsg=exports.isMixedExports=exports.isMappings=exports.isConditions=exports.isUrl=exports.findPackageJson=void 0;const fs_1=__importDefault(require("fs")),json5_1=__importDefault(require("json5")),path_1=__importDefault(require("path")),fs_js_1=require("../../../util/fs.js");function isModuleDir(r,e){return e.some((e=>r.endsWith(e)))}async function findPackageJson(r,e){const{root:o}=path_1.default.parse(r);let s=r;for(;s!==o&&!isModuleDir(s,e);){const r=path_1.default.join(s,"oh-package.json5");if(await(0,fs_js_1.fileExists)(r)){const e=fs_1.default.readFileSync(r,"utf-8");return{pkgJson:json5_1.default.parse(e),pkgPath:s,pkgJsonPath:r}}s=path_1.default.resolve(s,"..")}return null}function isUrl(r){try{return!!new URL(r)}catch(r){return!1}}function isConditions(r){return"object"==typeof r&&Object.keys(r).every((r=>!r.startsWith(".")))}function isMappings(r){return"object"==typeof r&&!isConditions(r)}function isMixedExports(r){const e=Object.keys(r);return e.some((r=>r.startsWith(".")))&&e.some((r=>!r.startsWith(".")))}function createBaseErrorMsg(r,e){return`Could not resolve import "${r}" in ${e}`}function createErrorMsg(r,e,o){const{importSpecifier:s,importer:t,pkgJsonPath:i}=r;return`${createBaseErrorMsg(s,t)} using ${o?"imports":"exports"} defined in ${i}.${e?` ${e}`:""}`}exports.findPackageJson=findPackageJson,exports.isUrl=isUrl,exports.isConditions=isConditions,exports.isMappings=isMappings,exports.isMixedExports=isMixedExports,exports.createBaseErrorMsg=createBaseErrorMsg,exports.createErrorMsg=createErrorMsg;class ResolveError extends Error{}exports.ResolveError=ResolveError;class InvalidConfigurationError extends ResolveError{constructor(r,e){super(createErrorMsg(r,`Invalid "exports" field. ${e}`))}}exports.InvalidConfigurationError=InvalidConfigurationError;class InvalidModuleSpecifierError extends ResolveError{constructor(r,e,o){super(createErrorMsg(r,o,e))}}exports.InvalidModuleSpecifierError=InvalidModuleSpecifierError;class InvalidPackageTargetError extends ResolveError{constructor(r,e){super(createErrorMsg(r,e))}}exports.InvalidPackageTargetError=InvalidPackageTargetError;