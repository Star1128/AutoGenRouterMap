"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCopyPluginConfig=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),utils_js_1=require("./utils.js");function renameDestFile(e){return(t,s,a)=>{a=(0,utils_js_1.toUnixPath)(a);const r=(0,utils_js_1.toUnixPath)(e);if(-1!==a.indexOf(r)){let e=a.replace(r,"");return e.startsWith("/")&&(e=e.substring(1)),e}return`${t}.${s}`}}function formatCopyPatterns(e){return e.forEach((e=>{e.src=(0,utils_js_1.toUnixPath)(e.src),e.dest=(0,utils_js_1.toUnixPath)(e.dest)})),e}function getCopyPluginConfig(e,t){const s=[],a="../share",r=e.aceModuleRoot,i=e.aceModuleBuild||path_1.default.resolve(r,"build");s.push({src:path_1.default.resolve(r,"**/*"),dest:i,ignore:["**/*.ets","**/*.ts","**/*.js"],onlyFiles:!0,rename:renameDestFile(r)});const n=path_1.default.resolve(r,a);fs_1.default.existsSync(n)&&s.push({src:path_1.default.resolve(n,"**/*"),dest:path_1.default.resolve(i,a),ignore:["**/*.ets","**/*.ts","**/*.js"],onlyFiles:!0,rename:renameDestFile(n)});"page"===(e.abilityType??"page")&&e.aceManifestPath&&fs_1.default.existsSync(e.aceManifestPath)&&s.push({src:e.aceManifestPath,dest:i});const o=/ets_loader_ark$/.test(__dirname),l=e.cachePath??path_1.default.resolve(__dirname,"node_modules/.cache");return t&&fs_1.default.existsSync(t)&&!o&&e.isPreview&&s.push({src:path_1.default.resolve(__dirname,t),dest:path_1.default.resolve(__dirname,l)}),formatCopyPatterns(s)}exports.getCopyPluginConfig=getCopyPluginConfig;