"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(s,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HosLicenseManager=void 0;const sdkmanager_common_1=require("@ohos/sdkmanager-common"),hos_biz_util_1=require("../util/hos-biz-util"),path_1=__importDefault(require("path"));class HosLicenseManager extends sdkmanager_common_1.AbstractLicenseManager{constructor(e,t){super(),this._sdkSettings=e,this._netClient=t}getLicensesRootLocation(){return path_1.default.resolve(this._sdkSettings.getLocation())}getReadLocalHashErrorMessage(e){return new sdkmanager_common_1.ErrorTip("Failed to read the license file.","The license file may be corrupted or missing.",`Delete the ${e} folder and       go to Tools > SDK Manager > SDK > HarmonyOS to download any SDK. Open SDK Manager`).getMessage()}retrieveLicenses(e,t){return __awaiter(this,void 0,void 0,(function*(){const n=new Map;try{const o=yield this._sdkSettings.getGrsService(),s=(0,hos_biz_util_1.getSdkLicenseUrl)(o),r=yield this._netClient.doPost(s,t,this._createLicenseReqDto(e));if(r)for(const e of r){const t={id:e.name,content:e.content};n.set(e.name,t)}}catch(e){t.warn(`Failed to request HarmonyOS SDK license, ${e}`)}return n}))}_createLicenseReqDto(e){return{language:"en",licenseIds:e,countryCode:this._sdkSettings.getCountry()}}}exports.HosLicenseManager=HosLicenseManager;