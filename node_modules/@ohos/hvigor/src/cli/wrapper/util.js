"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCurrentProjectCacheDirHash=exports.getHvigorProjectHome=exports.executeCommand=exports.hasNpmPackInPaths=void 0;const child_process_1=require("child_process"),fs_1=__importDefault(require("fs")),fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),process_1=__importDefault(require("process")),hvigor_log_js_1=require("../../base/log/hvigor-log.js"),const_js_1=require("../../common/const/const.js"),path_const_js_1=require("../../common/const/path-const.js"),hash_util_js_1=require("../../common/util/hash-util.js"),hvigor_user_home_js_1=require("../../common/util/hvigor-user-home.js"),parse_json_util_js_1=require("../../common/util/parse-json/parse-json-util.js"),_log=hvigor_log_js_1.HvigorLogger.getLogger("hvigor");function hasNpmPackInPaths(e,r){try{return require.resolve(e,{paths:[...r]}),!0}catch(e){return!1}}function executeCommand(e,r,t,o){if(0!==(0,child_process_1.spawnSync)(e,r,t).status){_log.error(`${e} execute failed.`);try{fs_extra_1.default.removeSync(o)}catch(e){_log.error(`Deleting the directory ${o} failed. Please try delete and execute again`)}process_1.default.exit(-1)}}function getHvigorProjectHome(){const e=path_1.default.resolve((0,hvigor_user_home_js_1.getHvigorUserHomeCacheDir)(),const_js_1.PROJECT_CACHES,(0,hash_util_js_1.hash)(path_1.default.resolve(process_1.default.cwd())),const_js_1.WORK_SPACE);return process_1.default.env.WORKSPACE_DIR=e,e}function getCurrentProjectCacheDirHash(){var e;return(0,hash_util_js_1.hash)(null!==(e=process_1.default.env.NODE_PATH)&&void 0!==e?e:"")}function readProjectHvigorConfig(){var e;const r=path_1.default.resolve(path_const_js_1.HVIGOR_PROJECT_WRAPPER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);fs_1.default.existsSync(r)||_log.errorMessageExit(`Error: Hvigor config file ${r} does not exist.`);const t=(0,parse_json_util_js_1.parseJsonFile)(r);return t.dependencies=null!==(e=t.dependencies)&&void 0!==e?e:{},delete t.dependencies["@ohos/hvigor"],delete t.dependencies["@ohos/hvigor-ohos-plugin"],t}exports.hasNpmPackInPaths=hasNpmPackInPaths,exports.executeCommand=executeCommand,exports.getHvigorProjectHome=getHvigorProjectHome,exports.getCurrentProjectCacheDirHash=getCurrentProjectCacheDirHash;