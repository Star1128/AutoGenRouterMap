"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.daemonBoot=void 0;const process_1=__importDefault(require("process")),index_js_1=require("../../base/boot/index.js"),build_event_js_1=require("../../base/common/daemon-protocol/build-event.js"),default_daemon_connector_js_1=require("../../base/daemon/connection/default-daemon-connector.js"),hvigor_daemon_client_log_js_1=require("../../base/daemon/log/hvigor-daemon-client-log.js"),global_core_parameters_js_1=require("../../base/internal/data/global-core-parameters.js"),pretty_hrtime_js_1=__importDefault(require("../../common/util/pretty-hrtime.js")),client_event_handler_js_1=require("../handler/client-event-handler.js"),log=hvigor_daemon_client_log_js_1.HvigorDaemonClientLogger.getLogger("daemon-client");async function daemonBoot(e){const t=process_1.default.hrtime(),n=new default_daemon_connector_js_1.DefaultDaemonConnector,o=await n.getDaemonConnection();o?(o.on(build_event_js_1.BuildEvent.BUILD_STATUS,client_event_handler_js_1.handleBuildStatus),o.on(build_event_js_1.BuildEvent.OUTPUT,client_event_handler_js_1.printLog),o.on(build_event_js_1.WatchEvent.WATCH_RESULT,client_event_handler_js_1.handleWatchBuildResult),o.on(build_event_js_1.WatchEvent.WATCH_LOG,client_event_handler_js_1.handleWatchLog),o.emit(build_event_js_1.BuildEvent.COMMON_BUILD,e),log.debug(`hvigor client: Connection initTime: ${(0,pretty_hrtime_js_1.default)(process_1.default.hrtime(t))}`)):(global_core_parameters_js_1.coreParameter.startParams.daemon=!1,log.warn("hvigor client: Failed to find or create an available daemon. Build will be executed in no-daemon mode."),await(0,index_js_1.boot)(e)),process_1.default.on("exit",(e=>{log.debug("hvigor client: Connection will disconnect and exit process."),null==o||o.disconnect(),process_1.default.exit(null!=e?e:0)}))}exports.daemonBoot=daemonBoot;