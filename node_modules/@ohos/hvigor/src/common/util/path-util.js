"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PathUtil=void 0;const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),process_1=__importDefault(require("process")),extra_config_js_1=require("../../base/data/extra-config.js"),const_js_1=require("../const/const.js"),path_const_js_1=require("../const/path-const.js"),hvigor_config_loader_js_1=require("./hvigor-config-loader.js");class PathUtil{static getHvigorCacheDir(t){var e;let a=void 0!==process_1.default.env.config?JSON.parse(process_1.default.env.config)[const_js_1.BUILD_CACHE_DIR]:null!==(e=(0,extra_config_js_1.getExtraConfig)(const_js_1.BUILD_CACHE_DIR))&&void 0!==e?e:PathUtil.getCommandHvigorCacheDir();const r=path_1.default.resolve(path_const_js_1.HVIGOR_PROJECT_ROOT_DIR,const_js_1.HVIGOR_USER_HOME_DIR_NAME);return a||(a=hvigor_config_loader_js_1.HvigorConfigLoader.getInstance().getPropertiesConfigValue(const_js_1.HVIGOR_CACHE_DIR_KEY),a)?path_1.default.isAbsolute(a)?(t&&!this.hvigorCacheDirHasLogged&&(t.warn("Please ensure no projects of the same name have the same custom hvigor data dir."),this.hvigorCacheDirHasLogged=!0),path_1.default.resolve(a,path_1.default.basename(process_1.default.cwd()),const_js_1.HVIGOR_USER_HOME_DIR_NAME)):(t&&!this.hvigorCacheDirHasLogged&&(t.warn(`Invalid custom hvigor data dir:${a}`),this.hvigorCacheDirHasLogged=!0),r):r}static checkCopyPathIsSame(t,e){const a=PathUtil.getStatsSync(t),r=PathUtil.getStatsSync(e);return!(!r||!a)&&!!PathUtil.areIdentical(a,r)}static getStatsSync(t){let e;try{e=fs_extra_1.default.statSync(t)}catch(t){return null}return e}static areIdentical(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}static getCommandHvigorCacheDir(){return process_1.default.argv.forEach((t=>{t.startsWith(const_js_1.BUILD_CACHE_DIR)&&(process_1.default.env.BUILD_CACHE_DIR=t.substring(t.indexOf("=")+1))})),process_1.default.env.BUILD_CACHE_DIR}static getReportDirPath(){return path_1.default.resolve(PathUtil.getHvigorCacheDir(),"report")}}exports.PathUtil=PathUtil,PathUtil.hvigorCacheDirHasLogged=!1;