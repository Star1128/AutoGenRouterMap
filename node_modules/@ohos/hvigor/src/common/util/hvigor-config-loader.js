"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HvigorConfigLoader=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),process_1=__importDefault(require("process")),global_core_parameters_js_1=require("../../base/internal/data/global-core-parameters.js"),const_js_1=require("../const/const.js"),path_const_js_1=require("../const/path-const.js"),path_const_js_2=require("../const/path-const.js"),parse_json_util_js_1=require("./parse-json/parse-json-util.js");class HvigorConfigLoader{constructor(){const e=path_1.default.resolve(path_const_js_1.HVIGOR_PROJECT_WRAPPER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);if(!fs_1.default.existsSync(e))return;const t=(0,parse_json_util_js_1.parseJsonFile)(e),s=path_1.default.resolve(path_const_js_2.HVIGOR_USER_HOME,const_js_1.DEFAULT_HVIGOR_CONFIG_JSON_FILE_NAME);let o;fs_1.default.existsSync(s)&&(o=(0,parse_json_util_js_1.parseJsonFile)(s),t.properties={...o.properties,...t.properties}),this.hvigorConfig=t}static init(e){var t,s;if(void 0===e)return void(process_1.default.env.config=void 0);const o=HvigorConfigLoader.getConfigs();let r={};null===(t=e.config)||void 0===t||t.forEach((e=>{const t=e.split("=");2===t.length&&(r[t[0]]=t[t.length-1],this.initCommandLineProperties(t[0],t[t.length-1]))})),Array.isArray(e.prop)&&(null===(s=e.prop)||void 0===s||s.forEach((e=>{const t=e.split("=");2===t.length&&(r[t[0]]=t[t.length-1],this.initCommandLineProperties(t[0],t[t.length-1]))}))),r={...o,...r},process_1.default.env.config=JSON.stringify(r)}static initCommandLineProperties(e,t){if(!e.startsWith(`${const_js_1.PROPERTIES+const_js_1.DOT}`))return;const s=e.substring(`${const_js_1.PROPERTIES+const_js_1.DOT}`.length);global_core_parameters_js_1.coreParameter.properties[s]=this.convertToParamValue(t)}static convertToParamValue(e){let t=Number(e);return e.length<=16&&!isNaN(t)?t:(t="true"===e||"false"!==e&&t,"boolean"==typeof t?t:e.trim())}getHvigorConfig(){return this.hvigorConfig}getPropertiesConfigValue(e){var t;const s=HvigorConfigLoader.getConfigs()["properties.".concat(e)],o=void 0!==process_1.default.env.config&&null!==(t=JSON.parse(process_1.default.env.config)["properties.".concat(e)])&&void 0!==t?t:s;return void 0!==o?this.parseConfigValue(o):void 0!==this.hvigorConfig&&this.hvigorConfig.properties?this.hvigorConfig.properties[e]:void 0}static getInstance(){return new HvigorConfigLoader}static getConfigs(){const e=process_1.default.argv.slice(2),t=/^(--config|-c).*/,s=/^(--config|-c)$/,o={};for(const[r,i]of e.entries())if(s.test(i)){const t=e[r+1].split("=");2===t.length&&(o[t[0]]=t[t.length-1])}else if(t.test(i)){const e=i.match(t);if(e&&e[0].length<i.length){const t=i.substring(e[0].length).split("=");2===t.length&&(o[t[0]]=t[t.length-1])}}return o}parseConfigValue(e){if("true"===e.toLowerCase())return!0;if("false"===e.toLowerCase())return!1;const t=Number(e);return isNaN(t)?e:t}}exports.HvigorConfigLoader=HvigorConfigLoader;