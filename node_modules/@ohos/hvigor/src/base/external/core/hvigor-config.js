"use strict";var __importDefault=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hvigorConfigInit=exports.hvigorConfig=exports.HvigorConfig=void 0;const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),common_const_js_1=require("../../common/options/common-const.js"),hvigor_log_js_1=require("../../log/hvigor-log.js"),file_util_js_1=require("../../util/file-util.js"),json5_reader_js_1=require("../../util/json5-reader.js"),validate_util_js_1=require("../../util/validate-util.js"),HvigorNodeDescriptorImpl_js_1=require("../../vigor/plugin/impl/HvigorNodeDescriptorImpl.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("hvigor-config");class HvigorConfig{constructor(o){const e=path_1.default.resolve(o.getNodeDir(),common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE),r=json5_reader_js_1.Json5Reader.getJson5Obj(e).modules;checkProjectConfigFile(o,r),this.allChildrenNodeDescriptor=[],r.forEach((e=>{validate_util_js_1.ValidateUtil.validateModule(e);const r=new HvigorNodeDescriptorImpl_js_1.HvigorNodeDescriptorImpl(e.name,e.srcPath,void 0,this.rootNodeDescriptor);(0,file_util_js_1.exitIfNotExists)(log,path_1.default.resolve(o.getNodeDir(),e.srcPath),"modules",path_1.default.resolve(o.getNodeDir(),common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE)),this.allChildrenNodeDescriptor.push(r)})),this.rootNodeDescriptor=new HvigorNodeDescriptorImpl_js_1.HvigorNodeDescriptorImpl(o.getName(),o.getNodeDir(),this.allChildrenNodeDescriptor,void 0)}includeNode(o,e,r){fs_1.default.existsSync(e)||log.errorExit(new Error(`Path not found: ${e}`));const t=new HvigorNodeDescriptorImpl_js_1.HvigorNodeDescriptorImpl(o,e,void 0,this.rootNodeDescriptor);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&t.extraOptions.set(o,r[o]);this.allChildrenNodeDescriptor.push(t),this.rootNodeDescriptor.setChildNode(this.allChildrenNodeDescriptor)}excludeNodeByName(o){this.allChildrenNodeDescriptor.find((e=>e.name===o))||log.warn(`The Node to exclude '${o}' was not found.`),this.allChildrenNodeDescriptor=this.allChildrenNodeDescriptor.filter((e=>e.name!==o)),this.rootNodeDescriptor.setChildNode(this.allChildrenNodeDescriptor)}getAllNodeDescriptor(){return this.allChildrenNodeDescriptor}getRootNodeDescriptor(){return this.rootNodeDescriptor}getNodeDescriptorByName(o){return this.allChildrenNodeDescriptor.find((e=>e.name===o))}}function checkProjectConfigFile(o,e){Array.isArray(e)||log.errorMessageExit(`'modules' property should be an array in root project ${common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE}\n                at ${path_1.default.resolve(o.getNodeDir(),common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE)}`),e&&0!==e.length||log.errorMessageExit(`No modules found, Please check root project ${common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE}\n                at ${path_1.default.resolve(o.getNodeDir(),common_const_js_1.HvigorCommonConst.BUILD_PROFILE_FILE)}`)}function hvigorConfigInit(o){exports.hvigorConfig=new HvigorConfig(o)}exports.HvigorConfig=HvigorConfig,exports.hvigorConfigInit=hvigorConfigInit;