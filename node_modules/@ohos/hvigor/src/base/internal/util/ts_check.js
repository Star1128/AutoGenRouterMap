"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setHvigorConfigFileTsRoot=exports.formatDiagnostic=exports.hvigorfileTypeCheck=exports.hvigorConfigFileTsRoot=exports.targetModules=exports.targetRoots=exports.hvigorfileTSRoots=void 0;const process_1=__importDefault(require("process")),typescript_1=__importDefault(require("typescript")),hvigor_log_js_1=require("../../log/hvigor-log.js"),compile_options_js_1=require("../../util/options/compile-options.js"),time_util_js_1=require("../../util/time-util.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("ts-check");function hvigorfileTypeCheck(){const e=process_1.default.hrtime(),t={getCanonicalFileName:e=>e,getCurrentDirectory:typescript_1.default.sys.getCurrentDirectory,getNewLine:()=>typescript_1.default.sys.newLine},o=typescript_1.default.createProgram([...exports.targetRoots],compile_options_js_1.compilerOptions),i=typescript_1.default.getPreEmitDiagnostics(o),r=process_1.default.hrtime(e),s=(0,time_util_js_1.formatTime)(r);for(const e of i)log.error(formatDiagnostic(e,t));i.length?log.errorMessageExit("Please fix above type errors."):log.info(`TYPE CHECK SUCCESSFUL in ${s}`)}function formatDiagnostic(e,t,o){const i=`${diagnosticCategoryName(e)} TS${e.code}: ${typescript_1.default.flattenDiagnosticMessageText(e.messageText,t.getNewLine())}${t.getNewLine()}`;if(e.file){const{line:t,character:r}=typescript_1.default.getLineAndCharacterOfPosition(e.file,e.start);return`${i} at ${null!=o?o:e.file.fileName}:${t+1}:${r+1} `}return i}function diagnosticCategoryName(e,t=!0){const o=typescript_1.default.DiagnosticCategory[e.category];return t?o.toLowerCase():o}function setHvigorConfigFileTsRoot(e){exports.hvigorConfigFileTsRoot=e}exports.hvigorfileTSRoots=new Set,exports.targetRoots=new Set,exports.targetModules=new Set,exports.hvigorfileTypeCheck=hvigorfileTypeCheck,exports.formatDiagnostic=formatDiagnostic,exports.setHvigorConfigFileTsRoot=setHvigorConfigFileTsRoot;