"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractExecutePipeline=void 0;const common_const_js_1=require("../../../../common/options/common-const.js"),hvigor_trace_js_1=require("../../../../common/trace/hvigor-trace.js"),class_identify_util_js_1=require("../../../../util/class-identify-util.js"),task_executor_js_1=require("../../../core/task-executor.js"),task_runner_js_1=require("../../../task/core/task-runner.js"),task_path_util_js_1=require("../../../task/util/task-path-util.js");class AbstractExecutePipeline{constructor(t,s){this.shouldCheckTask=!1,this.project=t,this.taskOptions=s;const e=this.taskOptions.toRunTasks;this.toRunTask=e.length?e:["default"]}async startPipeline(){this.taskOptions.isNeedSync||this.recordTraceData(),await this.executeTask()}findAllNeedExecuteTasksForNodes(t){const s=[];return this.toRunTask.forEach((e=>{const i=t.filter((t=>t.hasTask(e))).map((t=>(0,task_path_util_js_1.union)((0,class_identify_util_js_1.instanceOf)(t,common_const_js_1.HvigorBuildConst.PROJECT_MODE)?"":t.getName(),e)));s.push(...i)})),s}recordTraceData(){hvigor_trace_js_1.hvigorTrace.moduleNum=this.project.getAllSubModules().length}async executeTask(){const t=this.taskOptions.isNeedSync?this.findPipeAllNeedExecuteSyncTasks():[];t.push(...this.findPipeAllNeedExecuteTasks()),await task_executor_js_1.taskExecutorInst.initTasks(t),await(0,task_runner_js_1.runTaskFromQueue)()}}exports.AbstractExecutePipeline=AbstractExecutePipeline;