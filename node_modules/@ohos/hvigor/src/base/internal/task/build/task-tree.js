"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TaskTree=void 0;const os=__importStar(require("os")),default_task_js_1=require("../../../external/task/default-task.js"),core_task_js_1=require("../../../external/task/core-task.js"),hvigor_log_js_1=require("../../../log/hvigor-log.js"),task_path_util_js_1=require("../util/task-path-util.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("no-pattern-info");class TaskTree extends default_task_js_1.DefaultTask{constructor(e){super(e,{name:"taskTree",group:core_task_js_1.HvigorTaskGroupType.HELP_TASK_GROUP,isEnabled:!0,description:"Displays the task dag tree of the HvigorCoreNode."})}registryAction(){return()=>{const e=["--------------------------------------------------------------------------",`All tasks dependencies from hvigor node '${this.node.getName()}'`,"--------------------------------------------------------------------------",""],t=this.node.getTaskGraph(),r=[];t.getAllStartNodes().forEach((e=>{const t=(0,task_path_util_js_1.getTaskNameFromTaskPath)(e),s=this.node.getTaskByName(t);s.getGroup()!==core_task_js_1.HvigorTaskGroupType.HELP_TASK_GROUP&&s.getGroup()!==core_task_js_1.HvigorTaskGroupType.SYNC_TASK_GROUP&&r.push(this.node.getTaskByName(t))}));for(const t of r){const r=t.getName();e.push(`:${this.node.getName()}:${r}`),this.renderTaskGraph(t.getDependsOn(),e,0)}log.info(e.join(os.EOL))}}renderTaskGraph(e,t,r){for(const s of e){const{moduleName:e,taskName:o}=(0,task_path_util_js_1.parseTaskPath)(s);if(e!==this.node.getName()){t.push(`${this.getEndNodePrefix(r)}${s}`);continue}const a=this.node.getTaskByName(o);if(void 0===a)return void log.errorMessageExit(`Can not find task ${o}`);0===a.getDependsOn().length?t.push(`${this.getEndNodePrefix(r)}${a.getName()}`):(t.push(`${this.getExpandNodePrefix(r)}${a.getName()}`),this.renderTaskGraph(a.getDependsOn(),t,r+1))}}getEndNodePrefix(e){let t="";for(let r=0;r<e;r++)t+="    ";return`${t}\\--- :`}getExpandNodePrefix(e){let t="";for(let r=0;r<e;r++)t+="    ";return`${t}+--- :`}}exports.TaskTree=TaskTree;