"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,i,t,r){void 0===r&&(r=t);var n=Object.getOwnPropertyDescriptor(i,t);n&&!("get"in n?!i.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(e,r,n)}:function(e,i,t,r){void 0===r&&(r=t),e[r]=i[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,i){Object.defineProperty(e,"default",{enumerable:!0,value:i})}:function(e,i){e.default=i}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(i,e,t);return __setModuleDefault(i,e),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.walkFileTree=exports.FileInfo=void 0;const FS=__importStar(require("fs")),PATH=__importStar(require("path")),file_type_js_1=require("./file-type.js");function safeReadDirSync(e){let i=[];try{i=FS.readdirSync(e)}catch(e){if("EACCES"!==e.code&&"EPERM"!==e.code)throw e}return i}function normalizePath(e){return e.replace(/\\/g,"/")}class FileInfo{constructor(e,i,t=file_type_js_1.FileType.UNKNOWN,r=0,n=0,o=!1){this.isSymbolicLink=!1,this.name=e,this.path=i,this.type=t,this.size=r,this.lastModifiedTime=n,this.isSymbolicLink=o}toString(){return`{name:${this.name},path:${this.path},type:${this.type},\n        size:${this.size},lastModifiedTime:${this.lastModifiedTime},isSymbolicLink:${this.isSymbolicLink}`}}function walkFile(e,i,t,r={}){const n=PATH.extname(e).toLowerCase();r.extensions&&!r.extensions.test(n)||t.visitFile(i)}function walkDirectory(e,i,t,r,n={},o){const s=safeReadDirSync(e);if(void 0===n.maxDepth||n.maxDepth>i){r.preVisitDirectory(t);for(const t of s)walkFileRecursive(PATH.join(e,t),i+1,r,n,o);r.postVisitDirectory(t)}}function walkFileRecursive(e,i=0,t,r={},n){let o,s;e=r.normalizePath?normalizePath(e):e;try{o=FS.statSync(e),s=FS.lstatSync(e)}catch(i){return void t.visitFileFailed(e,i)}if(r.exclude&&r.exclude.test(e))return;if(r.filter&&!r.filter.test(e))return;const l=o.isFile()?file_type_js_1.FileType.FILE:file_type_js_1.FileType.DIRECTORY,a=new FileInfo(PATH.basename(e),e,l,o.size,o.mtime.getTime(),s.isSymbolicLink());if(s.isSymbolicLink()){if(!1===r.followSymlinks)return;if(n.find((e=>e===s.ino)))return;n.push(s.ino)}o.isFile()?walkFile(e,a,t,r):o.isDirectory()&&walkDirectory(e,i,a,t,r,n)}function walkFileTree(e,i,t={}){walkFileRecursive(e,0,i,t,[])}exports.FileInfo=FileInfo,exports.walkFileTree=walkFileTree;