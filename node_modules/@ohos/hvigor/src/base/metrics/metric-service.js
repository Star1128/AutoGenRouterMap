"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MetricService=void 0;const report_js_1=require("../common/report/report.js"),report_service_impl_js_1=require("../common/report/report-service-impl.js"),metric_cache_service_js_1=require("../internal/cache/service/metric-cache-service.js"),base_event_js_1=require("./event/base-event.js"),duration_event_js_1=require("./event/duration-event.js"),log_event_js_1=require("./event/log-event.js");class MetricService{constructor(){this.metricCacheService=metric_cache_service_js_1.MetricCacheService.getInstance()}submit(e){this.metricCacheService.add(e)}getEventById(e){if(e)return this.metricCacheService.get(e)}queryReport(){let e=this.filterDurationEvent(this.metricCacheService.getEvents());return e=this.filterLogEvent(e),new report_js_1.Report("events",e)}filterDurationEvent(e){return e.filter((e=>{if(e.getType()===base_event_js_1.MetricEventType.DURATION){if(e.additional.state===duration_event_js_1.DurationEventState.CREATED)return!1}return!0}))}filterLogEvent(e){return e.filter((e=>{if(e.getType()===base_event_js_1.MetricEventType.LOG){const t=e,r=this.getEventById(t.additional.durationId);if(r&&r.additional.state===duration_event_js_1.DurationEventState.CREATED)return!1;if(t.additional.logType===log_event_js_1.MetricLogType.DETAIL&&!r)return!1}return!0}))}clear(){this.metricCacheService.close()}static getInstance(){return MetricService.instance||(MetricService.instance=new MetricService,report_service_impl_js_1.ReportServiceImpl.getInstance().addListener(MetricService.instance)),MetricService.instance}}exports.MetricService=MetricService;