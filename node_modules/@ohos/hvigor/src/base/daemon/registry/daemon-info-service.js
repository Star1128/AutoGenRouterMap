"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultDaemonInfoService=void 0;const crypto_1=require("crypto"),process_1=__importDefault(require("process")),util_js_1=require("../../../cli/wrapper/util.js"),wrapper_const_js_1=require("../../../cli/wrapper/wrapper-const.js"),const_js_1=require("../../../common/const/const.js"),hash_util_js_1=require("../../../common/util/hash-util.js"),hvigor_daemon_log_js_1=require("../log/hvigor-daemon-log.js"),session_id_js_1=require("../session/session-id.js"),daemon_info_js_1=require("./daemon-info.js"),_log=hvigor_daemon_log_js_1.HvigorDaemonLogger.getLogger("daemon");class DaemonInfoService{createDefaultDaemonInfo(e,o){var r;_log.debug(`hvigor daemon: Create default daemon info. execArgv=${[...process_1.default.execArgv]}`);const s=(0,util_js_1.getCurrentProjectCacheDirHash)();_log.debug(`hvigor work dir: ${s}`);const t=require.resolve(const_js_1.HVIGOR_ENGINE_PACKAGE_NAME);return{pid:process_1.default.pid,state:daemon_info_js_1.DaemonState.IDLE,address:e.address,cwdPath:process_1.default.cwd(),hvigorVersion:wrapper_const_js_1.CUR_HVIGOR_VERSION,keyId:(0,crypto_1.randomBytes)(20).toString("hex"),nodeParams:(0,hash_util_js_1.hash)(`${t}${s}${process_1.default.execArgv.toString()}`),nodeVersion:process_1.default.version,port:e.port,lastUsedTime:Date.now(),createdBy:null!==(r=process_1.default.env.CREATED_BY)&&void 0!==r?r:"command",sessionId:session_id_js_1.SessionIdHelper.encryptPwdByDefaultMaterial(o,_log)}}}exports.defaultDaemonInfoService=new DaemonInfoService;