"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultDaemonServerRegistry=void 0;const process_1=__importDefault(require("process")),hvigor_daemon_log_js_1=require("../log/hvigor-daemon-log.js"),daemon_info_js_1=require("./daemon-info.js"),default_daemon_registry_js_1=require("./default-daemon-registry.js"),_log=hvigor_daemon_log_js_1.HvigorDaemonLogger.getLogger("daemon");class DaemonServerRegistry extends default_daemon_registry_js_1.DefaultDaemonRegistry{constructor(){super(_log)}updateDaemonProcessState(e,o){const t=this.getDaemonInfoByPid(process_1.default.pid);if(!t)return void _log.debug("hvigor daemon: Cannot transform process state. Unable to find daemon info from registry.");const r={...t,state:e,info:o};_log.debug(`hvigor daemon: Update daemon info in registry. daemonInfo=${JSON.stringify(r)}`),this.setInfo(t.keyId,r)}getAllPortInUsed(){return this.getInfos().filter((e=>e.state!==daemon_info_js_1.DaemonState.BROKEN&&e.state!==daemon_info_js_1.DaemonState.STOPPED)).map((e=>e.port))}}exports.defaultDaemonServerRegistry=new DaemonServerRegistry;