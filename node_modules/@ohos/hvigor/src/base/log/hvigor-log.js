"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(r,t);i&&!("get"in i?!r.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,i)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.configure=exports.evaluateLogLevel=exports.HvigorLogger=void 0;const log4js=__importStar(require("log4js")),util=__importStar(require("util")),log_event_js_1=require("../metrics/event/log-event.js"),metric_factory_js_1=require("../metrics/metric-factory.js"),adaptor_js_1=require("./adaptor/adaptor.js"),default_configuration_js_1=require("./default-configuration.js");class HvigorLogger{constructor(e,r){log4js.configure((0,default_configuration_js_1.updateConfiguration)()),this._logger=log4js.getLogger(e),this._logger.level=(0,default_configuration_js_1.getLevel)(),this._filelogger=log4js.getLogger("debug-file"),this.durationId=r}static getLogger(e){return new HvigorLogger(e)}static getLoggerWithDurationId(e,r){return new HvigorLogger(e,r)}log(e,...r){this.createLogEventByDurationId(e,log_event_js_1.MetricLogType.INFO,...r),this._logger.log(e,...r),this._filelogger.log(e,...r)}debug(e,...r){this.createLogEventByDurationId(e,log_event_js_1.MetricLogType.DEBUG,...r),this._logger.debug(e,...r),this._filelogger.debug(e,...r)}info(e,...r){this.createLogEventByDurationId(e,log_event_js_1.MetricLogType.INFO,...r),this._logger.info(e,...r),this._filelogger.debug(e,...r)}warn(e,...r){void 0!==e&&""!==e&&(this.createLogEventByDurationId(e,log_event_js_1.MetricLogType.WARN,...r),this._logger.warn(e,...r),this._filelogger.warn(e,...r))}error(e,...r){this.createLogEventByDurationId(e,log_event_js_1.MetricLogType.ERROR,...r),this._logger.error(e,...r),this._filelogger.warn(e,...r)}_printTaskExecuteInfo(e,r){this._logger.info(`Finished :${e}... after ${r}`),this._filelogger.info(`Finished :${e}... after ${r}`)}_printFailedTaskInfo(e){this._logger.error(`Failed :${e}... `),this._filelogger.error(`Failed :${e}... `)}_printDisabledTaskInfo(e){this._logger.info(`Disabled :${e}... `),this._filelogger.info(`Disabled :${e}... `)}_printUpToDateTaskInfo(e){this._logger.info(`UP-TO-DATE :${e}...  `),this._filelogger.info(`UP-TO-DATE :${e}...  `)}_printStackErrorToFile(e,...r){this._filelogger.error(e,...r)}errorMessageExit(e,...r){throw new Error(util.format(e,...r))}errorExit(e,r,...t){if(r&&(metric_factory_js_1.MetricFactory.createLogEvent(this.getMessage(r,...t),log_event_js_1.MetricLogType.ERROR),this._logger.error(r,t),this._filelogger.error(r,t)),this._logger.error(e.stack),this._filelogger.error(e.stack),e.stack)throw metric_factory_js_1.MetricFactory.createLogEvent(e.stack,log_event_js_1.MetricLogType.ERROR),e}getLevel(){return this._logger.level}setLevel(e){this._logger.level=e}createLogEventByDurationId(e,r,...t){if("string"==typeof e){const o=metric_factory_js_1.MetricFactory.createLogEvent(this.getMessage(e,...t),r);this.durationId&&o.setDurationId(this.durationId)}return e}getMessage(e,...r){return r.length>0?util.format(e,...r):e}printError(e){let r="* Try the following:\n";e.solutions&&e.solutions.forEach((e=>{r+=`> ${e}\n`})),e.moreInfo&&(r+=`> More info: ${e.moreInfo}\n`),"* Try the following:\n"!==r?this._logger.error(`${e.message}\n\n${r}`):this._logger.error(e.message)}printErrorExit(e){throw this.printError(e),new adaptor_js_1.AdaptorError(e.message)}}function evaluateLogLevel(e,r){(0,default_configuration_js_1.setCategoriesLevel)(e,r),log4js.shutdown(),log4js.configure((0,default_configuration_js_1.updateConfiguration)())}function configure(e){const r=(0,default_configuration_js_1.getConfiguration)(),t={appenders:{...r.appenders,...e.appenders},categories:{...r.categories,...e.categories}};(0,default_configuration_js_1.setConfiguration)(t),log4js.shutdown(),log4js.configure(t)}exports.HvigorLogger=HvigorLogger,exports.evaluateLogLevel=evaluateLogLevel,exports.configure=configure;